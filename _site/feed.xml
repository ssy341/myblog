<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.7.2">Jekyll</generator><link href="http://www.thxopen.com/feed.xml" rel="self" type="application/atom+xml" /><link href="http://www.thxopen.com/" rel="alternate" type="text/html" /><updated>2018-09-20T12:03:28+08:00</updated><id>http://www.thxopen.com/</id><title type="html">单客欧朋</title><subtitle>好记性不如烂笔头</subtitle><author><name>单思义</name><email>keith@thxopen.com</email></author><entry><title type="html">Spring Data JPA自动创建表同时生成表和列的注释</title><link href="http://www.thxopen.com/java/2018/09/19/use-spring-data-jpa-to-gen-table-and-column-comment-in-mysql.html" rel="alternate" type="text/html" title="Spring Data JPA自动创建表同时生成表和列的注释" /><published>2018-09-19T00:00:00+08:00</published><updated>2018-09-19T00:00:00+08:00</updated><id>http://www.thxopen.com/java/2018/09/19/use-spring-data-jpa-to-gen-table-and-column-comment-in-mysql</id><content type="html" xml:base="http://www.thxopen.com/java/2018/09/19/use-spring-data-jpa-to-gen-table-and-column-comment-in-mysql.html">&lt;h2 id=&quot;创建表格时同时带上注释&quot;&gt;创建表格时同时带上注释&lt;/h2&gt;

&lt;p&gt;一般情况下我们使用注解的方式很方便的就可以通过java类生成数据库的表，然后把注释写在字段上，就像下面一样&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;lombok.Data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;javax.persistence.Entity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;javax.persistence.Table&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**
 * demo例子
 * &amp;lt;p&amp;gt;
 * 2018/9/18
 *
 * @author Keith
 * @version v0.0.1
 */&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@Entity&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@Table&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;tb_sample&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@Data&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Sample&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/**
     * 内容字段
     */&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;乍看，觉得已经很明白了，后面维护的人也能看明白。但如对于维护数据库的人来说可能就不是那么容易了，因为他们从数据库里看到的是下面的语句&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;CREATE TABLE &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;tb_sample&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;content&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt; varchar&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;255&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; DEFAULT NULL
&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ENGINE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;InnoDB &lt;span class=&quot;nv&quot;&gt;AUTO_INCREMENT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;92 DEFAULT &lt;span class=&quot;nv&quot;&gt;CHARSET&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;utf8&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;确实，这样看起来不怎么友好，为了解决这个问题，我们可以利用&lt;code class=&quot;highlighter-rouge&quot;&gt;org.hibernate.annotations.Table&lt;/code&gt;注解和&lt;code class=&quot;highlighter-rouge&quot;&gt;javax.persistence.Column&lt;/code&gt;
给表和列添加注释，更改之后如下所示：&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;lombok.Data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.hibernate.annotations.Table&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;


&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;javax.persistence.Column&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;javax.persistence.Entity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**
 * demo例子
 * &amp;lt;p&amp;gt;
 * 2018/9/18
 *
 * @author Keith
 * @version v0.0.1
 */&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@Entity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;tb_sample&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@Table&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;appliesTo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;tb_sample&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;comment&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;demo例子&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@Data&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Sample&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Column&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;columnDefinition&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;varchar(255) COMMENT '测试字段'&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;这样自动创建的表格在数据库里就会是下面的样子：&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;CREATE TABLE &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;tb_sample&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;content&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt; varchar&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;255&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; DEFAULT NULL COMMENT &lt;span class=&quot;s1&quot;&gt;'测试字段'&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ENGINE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;InnoDB &lt;span class=&quot;nv&quot;&gt;AUTO_INCREMENT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;92 DEFAULT &lt;span class=&quot;nv&quot;&gt;CHARSET&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;utf8 &lt;span class=&quot;nv&quot;&gt;COMMENT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'demo例子'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;这样，不仅java开发能方便的知道实体和每个字段的意思，维护数据库的人也没有压力，是不是挺方便的&lt;/p&gt;

&lt;h2 id=&quot;注意事项&quot;&gt;注意事项&lt;/h2&gt;

&lt;p&gt;使用上面的方式，虽然挺方便，但需要注意以下三点：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;1.数据库是mysql&lt;/li&gt;
  &lt;li&gt;2.需要配合Entity注解name属性一起使用，用上面的例子说明
    &lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@Entity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;tb_sample&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@Table&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;appliesTo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;tb_sample&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;comment&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;demo例子&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Sample&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;这里Entity的name的值要和Table的appliesTo的值一样。
一般情况下，我们没有给Entity的name赋值，默认就是实体的名称（这里是Sample），
如果你不指定Entity的name，那么Table的appliesTo的值为&lt;code class=&quot;highlighter-rouge&quot;&gt;Sample&lt;/code&gt;，即数据库表名也为&lt;code class=&quot;highlighter-rouge&quot;&gt;Sample&lt;/code&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;3.实体的别名不再默认是类名，而是name的值
这就意味着Repository里本来是可以写类名的（因为默认是Sample）而要写成&lt;code class=&quot;highlighter-rouge&quot;&gt;tb_sample&lt;/code&gt;（如下面代码），否则语句会解析错误，报找不到&lt;code class=&quot;highlighter-rouge&quot;&gt;Sample&lt;/code&gt;这个实体
    &lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@Modifying&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@Query&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;delete from tb_sample d where d.content=:content&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;deleteByContent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;@Param&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;content&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;Reference:&lt;/p&gt;
  &lt;ul&gt;
    &lt;li&gt;https://segmentfault.com/a/1190000015047290&lt;/li&gt;
    &lt;li&gt;https://blog.csdn.net/xiaxia_jessica/article/details/43274735&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;</content><author><name>单思义</name><email>keith@thxopen.com</email></author><category term="java" /><category term="jpa" /><category term="spring boot" /><category term="spring data jpa" /><category term="mysql" /><category term="comment" /><category term="table" /><category term="column" /><summary type="html">创建表格时同时带上注释 一般情况下我们使用注解的方式很方便的就可以通过java类生成数据库的表，然后把注释写在字段上，就像下面一样 import lombok.Data; import javax.persistence.Entity; import javax.persistence.Table; /** * demo例子 * &amp;lt;p&amp;gt; * 2018/9/18 * * @author Keith * @version v0.0.1 */ @Entity @Table(name = &quot;tb_sample&quot;) @Data public class Sample { /** * 内容字段 */ private String content; } 乍看，觉得已经很明白了，后面维护的人也能看明白。但如对于维护数据库的人来说可能就不是那么容易了，因为他们从数据库里看到的是下面的语句 CREATE TABLE `tb_sample` ( `content` varchar(255) DEFAULT NULL ) ENGINE=InnoDB AUTO_INCREMENT=92 DEFAULT CHARSET=utf8; 确实，这样看起来不怎么友好，为了解决这个问题，我们可以利用org.hibernate.annotations.Table注解和javax.persistence.Column 给表和列添加注释，更改之后如下所示： import lombok.Data; import org.hibernate.annotations.Table; import javax.persistence.Column; import javax.persistence.Entity; /** * demo例子 * &amp;lt;p&amp;gt; * 2018/9/18 * * @author Keith * @version v0.0.1 */ @Entity(name = &quot;tb_sample&quot;) @Table(appliesTo = &quot;tb_sample&quot;,comment = &quot;demo例子&quot;) @Data public class Sample { @Column(columnDefinition = &quot;varchar(255) COMMENT '测试字段'&quot;) private String content; } 这样自动创建的表格在数据库里就会是下面的样子： CREATE TABLE `tb_sample` ( `content` varchar(255) DEFAULT NULL COMMENT '测试字段' ) ENGINE=InnoDB AUTO_INCREMENT=92 DEFAULT CHARSET=utf8 COMMENT='demo例子'; 这样，不仅java开发能方便的知道实体和每个字段的意思，维护数据库的人也没有压力，是不是挺方便的 注意事项 使用上面的方式，虽然挺方便，但需要注意以下三点： 1.数据库是mysql 2.需要配合Entity注解name属性一起使用，用上面的例子说明 @Entity(name = &quot;tb_sample&quot;) @Table(appliesTo = &quot;tb_sample&quot;,comment = &quot;demo例子&quot;) public class Sample { 这里Entity的name的值要和Table的appliesTo的值一样。 一般情况下，我们没有给Entity的name赋值，默认就是实体的名称（这里是Sample）， 如果你不指定Entity的name，那么Table的appliesTo的值为Sample，即数据库表名也为Sample 3.实体的别名不再默认是类名，而是name的值 这就意味着Repository里本来是可以写类名的（因为默认是Sample）而要写成tb_sample（如下面代码），否则语句会解析错误，报找不到Sample这个实体 @Modifying @Query(&quot;delete from tb_sample d where d.content=:content&quot;) int deleteByContent(@Param(&quot;content&quot;) String content); Reference: https://segmentfault.com/a/1190000015047290 https://blog.csdn.net/xiaxia_jessica/article/details/43274735</summary></entry><entry><title type="html">像使用mybatis一样使用spring data jpa</title><link href="http://www.thxopen.com/java/2018/09/19/use-spring-data-jpa-extra-to-write-sql-like-mybatis.html" rel="alternate" type="text/html" title="像使用mybatis一样使用spring data jpa" /><published>2018-09-19T00:00:00+08:00</published><updated>2018-09-19T00:00:00+08:00</updated><id>http://www.thxopen.com/java/2018/09/19/use-spring-data-jpa-extra-to-write-sql-like-mybatis</id><content type="html" xml:base="http://www.thxopen.com/java/2018/09/19/use-spring-data-jpa-extra-to-write-sql-like-mybatis.html">&lt;h2 id=&quot;简介&quot;&gt;简介&lt;/h2&gt;

&lt;p&gt;自从用上了spring data jpa后，已经深深的喜欢上她的这种风格。简单的CURD操作、根据方法名动态生成sql，就这两点我已经很满足了。
虽然已经很强大，美中不足的是对原生sql的支持有点欠缺，不过好在有大神弥补了这个小小遗憾，下面介绍大神给的解决方案&lt;a href=&quot;https://github.com/slyak/spring-data-jpa-extra&quot;&gt;spring-data-jpa-extra&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;spring-data-jpa-extra&lt;/code&gt;是一个可以像使用mybatis一样的spring data jpa扩展，她在spring data jpa上扩展了sql模板的功能，解决下面三个问题：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;动态原生查询支持，如mybatis&lt;/li&gt;
  &lt;li&gt;可以返回任何类型的数据&lt;/li&gt;
  &lt;li&gt;没有代码，只有sql语句&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;本身强大的spring data jpa，加上动态原生sql的功能，简直就是如虎添翼，下面通过简单的介绍，告诉大家怎么使用这个插件&lt;/p&gt;

&lt;h2 id=&quot;配置&quot;&gt;配置&lt;/h2&gt;

&lt;p&gt;作者已经把源码放在github上，并在maven仓库里发布了对应的jar，可供依赖使用，如果你正在使用maven，只需要添加下面代码，即可使用她&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;第一步：引入依赖&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.slyak&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-data-jpa-extra&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;2.1.1.RELEASE&lt;span class=&quot;nt&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ps:github上的readme给出的是&lt;code class=&quot;highlighter-rouge&quot;&gt;2.1.2.RELEASE&lt;/code&gt;，但我在使用的时候，只能下载到2.1.1的版本，具体原因不太清楚，大家参考的时候多尝试一下&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;第二步：开启功能并配置Freemark&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;com.slyak.spring.jpa.FreemarkerSqlTemplates&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;com.slyak.spring.jpa.GenericJpaRepositoryFactoryBean&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;com.slyak.spring.jpa.GenericJpaRepositoryImpl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.context.annotation.Bean&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.context.annotation.ComponentScan&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.context.annotation.Configuration&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.data.jpa.repository.config.EnableJpaRepositories&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**
 * spring data jpa extra 配置
 * &amp;lt;p&amp;gt;
 * 2018/9/18
 *
 * @author Keith
 * @version v0.0.1
 */&lt;/span&gt;

&lt;span class=&quot;nd&quot;&gt;@Configuration&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;//your base package&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@ComponentScan&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;com.thxopen&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@EnableJpaRepositories&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;//your repository package&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;basePackages&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;com.thxopen.dao.repository&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;repositoryBaseClass&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GenericJpaRepositoryImpl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; 
        &lt;span class=&quot;n&quot;&gt;repositoryFactoryBeanClass&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GenericJpaRepositoryFactoryBean&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;RepositoryConfig&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Bean&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FreemarkerSqlTemplates&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;freemarkerSqlTemplates&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;FreemarkerSqlTemplates&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;templates&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FreemarkerSqlTemplates&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;templates&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setSuffix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;.sftl&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;templates&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;使用&quot;&gt;使用&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;第一步：创建实体和DTO&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Sample.java&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;lombok.Data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.hibernate.annotations.Table&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;javax.persistence.Column&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;javax.persistence.Entity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**
 * demo例子
 * &amp;lt;p&amp;gt;
 * 2018/9/18
 *
 * @author Keith
 * @version v0.0.1
 */&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@Entity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;tb_sample&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@Table&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;appliesTo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;tb_sample&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;comment&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;demo例子&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@Data&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Sample&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Column&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;columnDefinition&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;varchar(255) COMMENT '测试字段'&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;SampleDTO.java&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SampleDTO&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contentShow&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;setId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getContentShow&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contentShow&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;setContentShow&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contentShow&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;contentShow&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contentShow&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;SampleQuery.java&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SampleQuery&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getContent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;setContent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;%&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;%&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;第二步：创建Repository&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;与spring data jpa用法不一样的是，需要把继承&lt;code class=&quot;highlighter-rouge&quot;&gt;JpaRepository&lt;/code&gt;改为继承&lt;code class=&quot;highlighter-rouge&quot;&gt;GenericJpaRepository&lt;/code&gt;，代码如下&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;com.slyak.spring.jpa.GenericJpaRepository&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;com.slyak.spring.jpa.TemplateQuery&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;com.thxopen.dao.entity.Sample&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.data.domain.Page&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.data.domain.Pageable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.data.jpa.repository.Query&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.data.repository.query.Param&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;java.util.HashMap&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;java.util.List&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;java.util.Map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**
 * @author keith
 * @create 2018年9月18日15:03:59
 * @desc
 **/&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SampleRepository&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GenericJpaRepository&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Sample&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Long&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;


    &lt;span class=&quot;cm&quot;&gt;/**
     * spring data jpa 原生
     * 根据条件过滤
     * 更多写法参考 https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.query-creation
     * @param content
     * @return
     */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Sample&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;findAllByContent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;cm&quot;&gt;/**
     * spring data jpa 原生的native
     * @param name
     * @return
     */&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Query&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nativeQuery&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;select * from tb_sample where content like ?1&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Sample&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;findDtos2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;@Param&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;


    &lt;span class=&quot;cm&quot;&gt;/**
     * 分页过滤查询
     * @param content
     * @param pageable
     * @return
     */&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@TemplateQuery&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Page&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Sample&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;findByContent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;@Param&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;content&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Pageable&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pageable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/**
     * 分页对象过滤查询
     * @param sampleQuery
     * @param pageable
     * @return
     */&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@TemplateQuery&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Sample&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;findByTemplateQueryObject&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SampleQuery&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sampleQuery&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Pageable&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pageable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/**
     * 过滤计算总数
     * @param content
     * @return
     */&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@TemplateQuery&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;countContent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;@Param&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;content&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/**
     * 返回自定义的dto
     * @return
     */&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@TemplateQuery&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SampleDTO&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;findDtos&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;

    
    &lt;span class=&quot;cm&quot;&gt;/**
     * 返回map
     * keith-fix 目前还有报错，暂且不用
     * @return
     */&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@TemplateQuery&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;findMap&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ps:使用&lt;code class=&quot;highlighter-rouge&quot;&gt;@TemplateQuery&lt;/code&gt;自定义注解代表会根据方法名去模板文件里找相应的sql&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;第三步：在/resources/sqls创建对应的sql模板（tb_sample.sftl），文件名同Entity的name值&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;--findByContent&lt;/span&gt;
  SELECT &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; FROM tb_sample WHERE 1 &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1
&amp;lt;&lt;span class=&quot;c&quot;&gt;#if content??&amp;gt;&lt;/span&gt;
        AND content LIKE :content
&amp;lt;/#if&amp;gt;

&lt;span class=&quot;nt&quot;&gt;--countContent&lt;/span&gt;
SELECT count&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; FROM tb_sample WHERE 1 &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1
&amp;lt;&lt;span class=&quot;c&quot;&gt;#if content??&amp;gt;&lt;/span&gt;
  AND content LIKE :content
&amp;lt;/#if&amp;gt;

&lt;span class=&quot;nt&quot;&gt;--findDtos&lt;/span&gt;
SELECT &lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt;, content as contentShow FROM tb_sample

&lt;span class=&quot;nt&quot;&gt;--findByTemplateQueryObject&lt;/span&gt;
SELECT &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; FROM tb_sample WHERE 1 &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1
&amp;lt;&lt;span class=&quot;c&quot;&gt;#if content??&amp;gt;&lt;/span&gt;
 AND content LIKE :content
&amp;lt;/#if&amp;gt;

&lt;span class=&quot;nt&quot;&gt;--findMap&lt;/span&gt;
SELECT &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; FROM tb_sample
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;--&lt;/code&gt;后面的字符串和&lt;code class=&quot;highlighter-rouge&quot;&gt;Repository&lt;/code&gt;里的方法名一一对应&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;第四步：创建测试用例，验证方法&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;com.thxopen.Application&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;com.thxopen.dao.entity.Sample&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;com.thxopen.dao.repository.sample.SampleDTO&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;com.thxopen.dao.repository.sample.SampleQuery&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;com.thxopen.dao.repository.sample.SampleRepository&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;lombok.extern.slf4j.Slf4j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.junit.Assert&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.junit.Test&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.junit.runner.RunWith&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.beans.factory.annotation.Autowired&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.boot.autoconfigure.EnableAutoConfiguration&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.boot.test.context.SpringBootTest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.data.domain.Page&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.data.domain.PageRequest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.test.context.junit4.SpringRunner&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;java.util.List&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;java.util.Map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**
 * jpa类似mybatis用法测试用例
 * 教程参考：https://github.com/slyak/spring-data-jpa-extra
 * &amp;lt;p&amp;gt;
 * 2018/9/18
 *
 * @author Keith
 * @version v0.0.1
 */&lt;/span&gt;

&lt;span class=&quot;nd&quot;&gt;@RunWith&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SpringRunner&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@SpringBootTest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;classes&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Application&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@EnableAutoConfiguration&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@Slf4j&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SampleTest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Autowired&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;SampleRepository&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sampleRepository&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;delSomeSample&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;sampleRepository&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;deleteAll&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;addSomeSample&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;Sample&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sample&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Sample&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;sample&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setContent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;hello world&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;sampleRepository&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sample&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;findByTemplateQuery&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;PageRequest&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pageRequest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PageRequest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Page&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Sample&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;samples&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sampleRepository&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;findByContent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;%world%&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pageRequest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Assert&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;assertTrue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;samples&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getTotalElements&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;countByTemplateQuery&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sampleRepository&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;countContent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;%world%&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Assert&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;assertTrue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;findByTemplateQueryAndReturnDTOs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SampleDTO&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dtos&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sampleRepository&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;findDtos&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Assert&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;assertTrue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dtos&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;findByTemplateQueryWithTemplateQueryObject&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;SampleQuery&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sq&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SampleQuery&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;sq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setContent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;%world%&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Sample&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;samples&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sampleRepository&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;findByTemplateQueryObject&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Assert&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;assertTrue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;samples&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;findBySpringElQuery&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Sample&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dtos&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sampleRepository&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;findDtos2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;%world%&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Assert&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;assertTrue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dtos&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/**
     * keith-fix 会报错，问题暂时不知
     */&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;findMap&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;listMaps&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sampleRepository&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;findMap&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Assert&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;assertTrue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;listMaps&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;总结&quot;&gt;总结&lt;/h2&gt;

&lt;p&gt;从上面给出的代码可以看出&lt;code class=&quot;highlighter-rouge&quot;&gt;spring-data-jpa-extra&lt;/code&gt;确实很强大，在开发中效率能提高很多，希望本文能帮助到大家，同时在这里还要感谢作者的付出，谢谢&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Reference:&lt;/p&gt;
  &lt;ul&gt;
    &lt;li&gt;https://github.com/slyak/spring-data-jpa-extra&lt;/li&gt;
    &lt;li&gt;https://blog.csdn.net/qq_27384769/article/details/79283391&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;</content><author><name>单思义</name><email>keith@thxopen.com</email></author><category term="java" /><category term="jpa" /><category term="spring boot" /><category term="spring data jpa" /><category term="mybatis" /><category term="template" /><category term="query" /><summary type="html">简介 自从用上了spring data jpa后，已经深深的喜欢上她的这种风格。简单的CURD操作、根据方法名动态生成sql，就这两点我已经很满足了。 虽然已经很强大，美中不足的是对原生sql的支持有点欠缺，不过好在有大神弥补了这个小小遗憾，下面介绍大神给的解决方案spring-data-jpa-extra spring-data-jpa-extra是一个可以像使用mybatis一样的spring data jpa扩展，她在spring data jpa上扩展了sql模板的功能，解决下面三个问题： 动态原生查询支持，如mybatis 可以返回任何类型的数据 没有代码，只有sql语句 本身强大的spring data jpa，加上动态原生sql的功能，简直就是如虎添翼，下面通过简单的介绍，告诉大家怎么使用这个插件 配置 作者已经把源码放在github上，并在maven仓库里发布了对应的jar，可供依赖使用，如果你正在使用maven，只需要添加下面代码，即可使用她 第一步：引入依赖 &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;com.slyak&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;spring-data-jpa-extra&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;2.1.1.RELEASE&amp;lt;/version&amp;gt; &amp;lt;/dependency&amp;gt; ps:github上的readme给出的是2.1.2.RELEASE，但我在使用的时候，只能下载到2.1.1的版本，具体原因不太清楚，大家参考的时候多尝试一下 第二步：开启功能并配置Freemark import com.slyak.spring.jpa.FreemarkerSqlTemplates; import com.slyak.spring.jpa.GenericJpaRepositoryFactoryBean; import com.slyak.spring.jpa.GenericJpaRepositoryImpl; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.ComponentScan; import org.springframework.context.annotation.Configuration; import org.springframework.data.jpa.repository.config.EnableJpaRepositories; /** * spring data jpa extra 配置 * &amp;lt;p&amp;gt; * 2018/9/18 * * @author Keith * @version v0.0.1 */ @Configuration //your base package @ComponentScan(&quot;com.thxopen&quot;) @EnableJpaRepositories( //your repository package basePackages = &quot;com.thxopen.dao.repository&quot; , repositoryBaseClass = GenericJpaRepositoryImpl.class, repositoryFactoryBeanClass = GenericJpaRepositoryFactoryBean.class) public class RepositoryConfig { @Bean public FreemarkerSqlTemplates freemarkerSqlTemplates() { FreemarkerSqlTemplates templates = new FreemarkerSqlTemplates(); templates.setSuffix(&quot;.sftl&quot;); return templates; } } 使用 第一步：创建实体和DTO Sample.java import lombok.Data; import org.hibernate.annotations.Table; import javax.persistence.Column; import javax.persistence.Entity; /** * demo例子 * &amp;lt;p&amp;gt; * 2018/9/18 * * @author Keith * @version v0.0.1 */ @Entity(name = &quot;tb_sample&quot;) @Table(appliesTo = &quot;tb_sample&quot;,comment = &quot;demo例子&quot;) @Data public class Sample { @Column(columnDefinition = &quot;varchar(255) COMMENT '测试字段'&quot;) private String content; } SampleDTO.java public class SampleDTO { private long id; private String contentShow; public long getId() { return id; } public void setId(long id) { this.id = id; } public String getContentShow() { return contentShow; } public void setContentShow(String contentShow) { this.contentShow = contentShow; } } SampleQuery.java public class SampleQuery { private String content; public String getContent() { return content; } public void setContent(String content) { if (content != null) { this.content = &quot;%&quot; + content + &quot;%&quot;; } } } 第二步：创建Repository 与spring data jpa用法不一样的是，需要把继承JpaRepository改为继承GenericJpaRepository，代码如下 import com.slyak.spring.jpa.GenericJpaRepository; import com.slyak.spring.jpa.TemplateQuery; import com.thxopen.dao.entity.Sample; import org.springframework.data.domain.Page; import org.springframework.data.domain.Pageable; import org.springframework.data.jpa.repository.Query; import org.springframework.data.repository.query.Param; import java.util.HashMap; import java.util.List; import java.util.Map; /** * @author keith * @create 2018年9月18日15:03:59 * @desc **/ public interface SampleRepository extends GenericJpaRepository&amp;lt;Sample,Long&amp;gt; { /** * spring data jpa 原生 * 根据条件过滤 * 更多写法参考 https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.query-creation * @param content * @return */ List&amp;lt;Sample&amp;gt; findAllByContent(String content); /** * spring data jpa 原生的native * @param name * @return */ @Query(nativeQuery = true, value = &quot;select * from tb_sample where content like ?1&quot;) List&amp;lt;Sample&amp;gt; findDtos2(@Param(&quot;name&quot;) String name); /** * 分页过滤查询 * @param content * @param pageable * @return */ @TemplateQuery Page&amp;lt;Sample&amp;gt; findByContent(@Param(&quot;content&quot;) String content, Pageable pageable); /** * 分页对象过滤查询 * @param sampleQuery * @param pageable * @return */ @TemplateQuery List&amp;lt;Sample&amp;gt; findByTemplateQueryObject(SampleQuery sampleQuery, Pageable pageable); /** * 过滤计算总数 * @param content * @return */ @TemplateQuery Long countContent(@Param(&quot;content&quot;) String content); /** * 返回自定义的dto * @return */ @TemplateQuery List&amp;lt;SampleDTO&amp;gt; findDtos(); /** * 返回map * keith-fix 目前还有报错，暂且不用 * @return */ @TemplateQuery List&amp;lt;Map&amp;lt;String,Object&amp;gt;&amp;gt; findMap(); } ps:使用@TemplateQuery自定义注解代表会根据方法名去模板文件里找相应的sql 第三步：在/resources/sqls创建对应的sql模板（tb_sample.sftl），文件名同Entity的name值 --findByContent SELECT * FROM tb_sample WHERE 1 = 1 &amp;lt;#if content??&amp;gt; AND content LIKE :content &amp;lt;/#if&amp;gt; --countContent SELECT count(*) FROM tb_sample WHERE 1 = 1 &amp;lt;#if content??&amp;gt; AND content LIKE :content &amp;lt;/#if&amp;gt; --findDtos SELECT id, content as contentShow FROM tb_sample --findByTemplateQueryObject SELECT * FROM tb_sample WHERE 1 = 1 &amp;lt;#if content??&amp;gt; AND content LIKE :content &amp;lt;/#if&amp;gt; --findMap SELECT * FROM tb_sample --后面的字符串和Repository里的方法名一一对应 第四步：创建测试用例，验证方法 import com.thxopen.Application; import com.thxopen.dao.entity.Sample; import com.thxopen.dao.repository.sample.SampleDTO; import com.thxopen.dao.repository.sample.SampleQuery; import com.thxopen.dao.repository.sample.SampleRepository; import lombok.extern.slf4j.Slf4j; import org.junit.Assert; import org.junit.Test; import org.junit.runner.RunWith; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.boot.autoconfigure.EnableAutoConfiguration; import org.springframework.boot.test.context.SpringBootTest; import org.springframework.data.domain.Page; import org.springframework.data.domain.PageRequest; import org.springframework.test.context.junit4.SpringRunner; import java.util.List; import java.util.Map; /** * jpa类似mybatis用法测试用例 * 教程参考：https://github.com/slyak/spring-data-jpa-extra * &amp;lt;p&amp;gt; * 2018/9/18 * * @author Keith * @version v0.0.1 */ @RunWith(SpringRunner.class) @SpringBootTest(classes = Application.class) @EnableAutoConfiguration @Slf4j public class SampleTest { @Autowired SampleRepository sampleRepository; @Test public void delSomeSample() { sampleRepository.deleteAll(); } @Test public void addSomeSample() { for (int i = 0; i &amp;lt; 10; i++) { Sample sample = new Sample(); sample.setContent(&quot;hello world&quot; + i); sampleRepository.save(sample); } } @Test public void findByTemplateQuery() { PageRequest pageRequest = new PageRequest(1, 10); Page&amp;lt;Sample&amp;gt; samples = sampleRepository.findByContent(&quot;%world%&quot;, pageRequest); Assert.assertTrue(samples.getTotalElements() == 10); } @Test public void countByTemplateQuery() { long count = sampleRepository.countContent(&quot;%world%&quot;); Assert.assertTrue(count == 10); } @Test public void findByTemplateQueryAndReturnDTOs() { List&amp;lt;SampleDTO&amp;gt; dtos = sampleRepository.findDtos(); Assert.assertTrue(dtos.size() == 10); } @Test public void findByTemplateQueryWithTemplateQueryObject() { SampleQuery sq = new SampleQuery(); sq.setContent(&quot;%world%&quot;); List&amp;lt;Sample&amp;gt; samples = sampleRepository.findByTemplateQueryObject(sq, null); Assert.assertTrue(samples.size() == 10); } @Test public void findBySpringElQuery() { List&amp;lt;Sample&amp;gt; dtos = sampleRepository.findDtos2(&quot;%world%&quot;); Assert.assertTrue(dtos.size() == 10); } /** * keith-fix 会报错，问题暂时不知 */ @Test public void findMap() { List&amp;lt;Map&amp;lt;String, Object&amp;gt;&amp;gt; listMaps = sampleRepository.findMap(); Assert.assertTrue(listMaps.size() == 10); } } 总结 从上面给出的代码可以看出spring-data-jpa-extra确实很强大，在开发中效率能提高很多，希望本文能帮助到大家，同时在这里还要感谢作者的付出，谢谢 Reference: https://github.com/slyak/spring-data-jpa-extra https://blog.csdn.net/qq_27384769/article/details/79283391</summary></entry><entry><title type="html">Unknown column ‘NaN’ in ‘field list’</title><link href="http://www.thxopen.com/database/2018/09/19/unknown-column-nan-in-field-list.html" rel="alternate" type="text/html" title="Unknown column 'NaN' in 'field list'" /><published>2018-09-19T00:00:00+08:00</published><updated>2018-09-19T00:00:00+08:00</updated><id>http://www.thxopen.com/database/2018/09/19/unknown-column-nan-in-field-list</id><content type="html" xml:base="http://www.thxopen.com/database/2018/09/19/unknown-column-nan-in-field-list.html">&lt;h3 id=&quot;起因&quot;&gt;起因&lt;/h3&gt;

&lt;p&gt;使用mysql数据库，在插入数据时，抛出以下异常&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Unknown column &lt;span class=&quot;s1&quot;&gt;'NaN'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'field list'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;字面上意思：未知的列’NaN’在字段列表中&lt;/p&gt;

&lt;p&gt;我首先想到的是自己 insert 语句是不是有问题，但想到插入语句是由框架完成的，列因该不会弄错，那是什么原因呢？&lt;/p&gt;

&lt;p&gt;再看关键字&lt;code class=&quot;highlighter-rouge&quot;&gt;NaN&lt;/code&gt;，这个是&lt;code class=&quot;highlighter-rouge&quot;&gt;Not a Number&lt;/code&gt;的意思，我联想到我的插入数据包含浮点类型的数据，调试代码发现有除数为0的情况&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;//misV+rigVf 可能为 0&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;recallRate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rigVf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;misV&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rigVf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;perCategory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setReCallRate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recallRate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;当被除数为0，&lt;code class=&quot;highlighter-rouge&quot;&gt;recallRate&lt;/code&gt;的结果就是&lt;code class=&quot;highlighter-rouge&quot;&gt;NaN&lt;/code&gt;，导致mysql插入数据的时候，本来因该是一个浮点类型，结果插入了&lt;code class=&quot;highlighter-rouge&quot;&gt;NaN&lt;/code&gt;，mysql报错。&lt;/p&gt;

&lt;p&gt;找到原因了问题就好解决，在设置&lt;code class=&quot;highlighter-rouge&quot;&gt;recallRate&lt;/code&gt;值的时候判断一下&lt;/p&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Float&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isNaN&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recallRate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)){&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;perCategory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setReCallRate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;recallRate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;加上判断之后，问题解决&lt;/p&gt;

&lt;h3 id=&quot;总结&quot;&gt;总结&lt;/h3&gt;

&lt;p&gt;编码需要规范，不然就会出现这些低级错误&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Reference:&lt;/p&gt;
  &lt;ul&gt;
    &lt;li&gt;https://www.cnblogs.com/big-xuyue/p/4106130.html&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;</content><author><name>单思义</name><email>keith@thxopen.com</email></author><category term="mysql" /><category term="database" /><category term="error" /><category term="exception" /><summary type="html">起因 使用mysql数据库，在插入数据时，抛出以下异常 Unknown column 'NaN' in 'field list' 字面上意思：未知的列’NaN’在字段列表中 我首先想到的是自己 insert 语句是不是有问题，但想到插入语句是由框架完成的，列因该不会弄错，那是什么原因呢？ 再看关键字NaN，这个是Not a Number的意思，我联想到我的插入数据包含浮点类型的数据，调试代码发现有除数为0的情况 //misV+rigVf 可能为 0 float recallRate = rigVf / (misV + rigVf); perCategory.setReCallRate(recallRate); 当被除数为0，recallRate的结果就是NaN，导致mysql插入数据的时候，本来因该是一个浮点类型，结果插入了NaN，mysql报错。 找到原因了问题就好解决，在设置recallRate值的时候判断一下 if(!Float.isNaN(recallRate)){ perCategory.setReCallRate(recallRate); } 加上判断之后，问题解决 总结 编码需要规范，不然就会出现这些低级错误 Reference: https://www.cnblogs.com/big-xuyue/p/4106130.html</summary></entry><entry><title type="html">在ubuntu下使用mysqlbinlog恢复drop后的数据</title><link href="http://www.thxopen.com/database/2018/08/28/mysqlbinlog-recovery-data.html" rel="alternate" type="text/html" title="在ubuntu下使用mysqlbinlog恢复drop后的数据" /><published>2018-08-28T00:00:00+08:00</published><updated>2018-08-28T00:00:00+08:00</updated><id>http://www.thxopen.com/database/2018/08/28/mysqlbinlog-recovery-data</id><content type="html" xml:base="http://www.thxopen.com/database/2018/08/28/mysqlbinlog-recovery-data.html">&lt;h2 id=&quot;背景&quot;&gt;背景&lt;/h2&gt;

&lt;p&gt;我肯定跟mysql过不去，覆盖数据在我身上已经发生了2次了，难道我这是上演从删库到跑路么？&lt;/p&gt;

&lt;p&gt;在上次覆盖了数据之后，我就告诉自己操作数据库先备份，即便错了也可以恢复，这次操作之前我已经很谨慎了，可惜最后还是做错了。&lt;/p&gt;

&lt;p&gt;同事辛苦几周操作的数据被我一秒钟给覆盖了，我没有着急，我淡定，我回想上次误操作后，打开了mysql的日志功能，据说可以一定程度的恢复数据，
这次我来验证一下，通过我几个小时的挣扎，数据恢复过来，但从结果来看，并不是100%的恢复了，没办法，只能再花时间精力把数据重新来过。&lt;/p&gt;

&lt;p&gt;只可惜什么都有就是没有后悔药，写下此篇，引以为戒，&lt;strong&gt;数据一定一定一定要备份！！！操作一定一定一定要谨慎！！！&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;虽然没有100%的恢复，但是如果没有开启&lt;code class=&quot;highlighter-rouge&quot;&gt;log_bin&lt;/code&gt;那一定就恢复不了了，至少还有个救命稻草，下文介绍如何使用&lt;code class=&quot;highlighter-rouge&quot;&gt;mysqlbinlog&lt;/code&gt;命令恢复drop后的数据&lt;/p&gt;

&lt;h2 id=&quot;查看mysql日志是否开启&quot;&gt;查看mysql日志是否开启&lt;/h2&gt;

&lt;p&gt;进入mysql的配置目录，一般在&lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/mysql/mysql.conf.d&lt;/code&gt;目录里面，有如下两个文件&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;thxopen@Thxopen:/etc/mysql/mysql.conf.d&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls
&lt;/span&gt;mysqld.cnf  mysqld_safe_syslog.cnf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;编辑&lt;code class=&quot;highlighter-rouge&quot;&gt;mysqld.cnf&lt;/code&gt;文件，找到&lt;code class=&quot;highlighter-rouge&quot;&gt;log_bin&lt;/code&gt;配置&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# The following can be used as easy to replay backup logs or for replication.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# note: if you are setting up a replication slave, see README.Debian about&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#       other settings you may need to change.&lt;/span&gt;
server-id               &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1
log_bin                 &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /var/log/mysql/mysql-bin.log
expire_logs_days        &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 10
max_binlog_size   &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 500M
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;默认情况下&lt;code class=&quot;highlighter-rouge&quot;&gt;log_bin&lt;/code&gt;功能是关闭的，把 &lt;code class=&quot;highlighter-rouge&quot;&gt;server-id&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;log_bin&lt;/code&gt; 取消注释，保存退出，重启mysql即可。&lt;/p&gt;

&lt;h2 id=&quot;查找-mysql-日志文件&quot;&gt;查找 mysql 日志文件&lt;/h2&gt;

&lt;p&gt;根据&lt;code class=&quot;highlighter-rouge&quot;&gt;log_bin&lt;/code&gt;配置的日志目录，我找到了日志&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;thxopen@Thxopen:/etc/mysql/mysql.conf.d&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /var/log/mysql/
thxopen@Thxopen:/var/log/mysql&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls
&lt;/span&gt;error.log  mysql-bin.000001  mysql-bin.000002  mysql-bin.000003  mysql-bin.000004  mysql-bin.index
thxopen@Thxopen:/var/log/mysql&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ll
总用量 364160
drwxr-x--- 1 mysql adm          512 8月  29 10:06 ./
drwxrwxr-x 1 root  syslog       512 11月 18  2017 ../
&lt;span class=&quot;nt&quot;&gt;-rw-r-----&lt;/span&gt; 1 mysql adm    108427282 8月  29 10:13 error.log
&lt;span class=&quot;nt&quot;&gt;-rw-r-----&lt;/span&gt; 1 mysql mysql        154 8月  28 19:37 mysql-bin.000001
&lt;span class=&quot;nt&quot;&gt;-rw-r-----&lt;/span&gt; 1 mysql mysql        177 8月  28 19:55 mysql-bin.000002
&lt;span class=&quot;nt&quot;&gt;-rw-r-----&lt;/span&gt; 1 mysql mysql  264390804 8月  29 10:06 mysql-bin.000003
&lt;span class=&quot;nt&quot;&gt;-rw-r-----&lt;/span&gt; 1 mysql mysql        154 8月  29 10:06 mysql-bin.000004
&lt;span class=&quot;nt&quot;&gt;-rw-r-----&lt;/span&gt; 1 mysql mysql        128 8月  29 10:06 mysql-bin.index

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;mysql-bin.000001&lt;/code&gt; 即为我们需要的日志文件，使用&lt;code class=&quot;highlighter-rouge&quot;&gt;mysqlbinlog&lt;/code&gt;命令可以导出可执行的sql文件&lt;/p&gt;

&lt;h2 id=&quot;mysqlbinlog-介绍&quot;&gt;mysqlbinlog 介绍&lt;/h2&gt;

&lt;p&gt;像一般的系统一样，我们会对系统的每一个操作记录下操作日志，而&lt;code class=&quot;highlighter-rouge&quot;&gt;log_bin&lt;/code&gt;就是对数据库的每一个操作记录下的一个二进制的日志，里面包含了我们
所有执行的sql语句。&lt;/p&gt;

&lt;p&gt;通过此命令，我们可以导出我们操作的sql语句，这样达到恢复数据的目的。
关于&lt;code class=&quot;highlighter-rouge&quot;&gt;mysqlbinlog&lt;/code&gt;命令几个常使用的参数，可以帮助我们更快的找到我们的数据&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;--start-position&lt;/code&gt; 起始位置（不包含）&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;--stop-position&lt;/code&gt; 截止位置&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;--start-datetime&lt;/code&gt; 起始时间&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;--stop-datetime&lt;/code&gt; 截止时间&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;--base64-output=decode-rows&lt;/code&gt; 输出的文件base64解码&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;更多关于&lt;code class=&quot;highlighter-rouge&quot;&gt;mysqlbinlog&lt;/code&gt;的参数可以通过参数&lt;code class=&quot;highlighter-rouge&quot;&gt;--help&lt;/code&gt;获取&lt;/p&gt;

&lt;h2 id=&quot;模拟实际的操作新增数据修改数据删除表恢复数据&quot;&gt;模拟实际的操作，新增数据，修改数据，删除表，恢复数据&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;1，创建一张测试表&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;create&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;table&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tb_recovery_test&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;column1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;varchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;          &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;column2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;varchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;          &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;运行结果：&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql&amp;gt; create table tb_recovery_test
    -&amp;gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
    -&amp;gt;   &lt;span class=&quot;nb&quot;&gt;id &lt;/span&gt;int not null ,
    -&amp;gt;   column1 varchar&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;32&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;          null,
    -&amp;gt;   column2 varchar&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;32&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;          null
    -&amp;gt; &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
Query OK, 0 rows affected &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.05 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;2，插入测试数据&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;insert&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;into&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tb_recovery_test&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;column1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;column2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
      &lt;span class=&quot;k&quot;&gt;values&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'数据操作需谨慎'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'定期备份数据'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;insert&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;into&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tb_recovery_test&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;column1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;column2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
      &lt;span class=&quot;k&quot;&gt;values&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'后悔了'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'可是没有后悔药'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;运行结果：&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql&amp;gt; insert into tb_recovery_test &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt;,column1,column2&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    -&amp;gt;       values &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1,&lt;span class=&quot;s1&quot;&gt;'数据操作需谨慎'&lt;/span&gt;,&lt;span class=&quot;s1&quot;&gt;'定期备份数据'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
Query OK, 1 row affected &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.01 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

mysql&amp;gt; insert into tb_recovery_test &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt;,column1,column2&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    -&amp;gt;       values &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2,&lt;span class=&quot;s1&quot;&gt;'后悔了'&lt;/span&gt;,&lt;span class=&quot;s1&quot;&gt;'可是没有后悔药'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
Query OK, 1 row affected &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.01 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

mysql&amp;gt; &lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; from tb_recovery_test&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
+----+--------------+-------------------+
| &lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt; | column1      | column2           |
+----+--------------+-------------------+
|  1 | 数据操作需谨慎 | 定期备份数据        |
|  2 | 后悔了        | 可是没有后悔药      |
+----+--------------+-------------------+
2 rows &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;3，修改数据，这里模拟一下真实的场景，对数据进行修改，删除，添加字段操作&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;update&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tb_recovery_test&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;column1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'数据操作需谨慎,定期备份数据,什么都有就是没有后悔药'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;column2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;where&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;delete&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tb_recovery_test&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;where&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;ALTER&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tb_recovery_test&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;ADD&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;column3&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;varchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;insert&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;into&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tb_recovery_test&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;column1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;column2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;column3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
      &lt;span class=&quot;k&quot;&gt;values&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'新增了一个字段'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'新增了一个字段'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'新增了一个字段'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;update&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tb_recovery_test&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;column3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'修改了新增字段的值'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;where&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;update&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tb_recovery_test&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;column2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'修改了column2字段的值'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;where&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;运行结果：&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql&amp;gt; update tb_recovery_test &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;column1 &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'数据操作需谨慎,定期备份数据,什么都有就是没有后悔药'&lt;/span&gt;,
    -&amp;gt;         column2 &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; null
    -&amp;gt;         where &lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 2&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
Query OK, 1 row affected &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.01 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Rows matched: 1  Changed: 1  Warnings: 0

mysql&amp;gt; delete from tb_recovery_test where &lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
Query OK, 1 row affected &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

mysql&amp;gt; ALTER TABLE tb_recovery_test ADD column3 varchar&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;32&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; NULL&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
Query OK, 0 rows affected &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.10 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Records: 0  Duplicates: 0  Warnings: 0

mysql&amp;gt; insert into tb_recovery_test &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt;,column1,column2,column3&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    -&amp;gt;       values &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3,&lt;span class=&quot;s1&quot;&gt;'新增了一个字段'&lt;/span&gt;,&lt;span class=&quot;s1&quot;&gt;'新增了一个字段'&lt;/span&gt;,&lt;span class=&quot;s1&quot;&gt;'新增了一个字段'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
Query OK, 1 row affected &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.01 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

mysql&amp;gt; update tb_recovery_test &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;column3 &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'修改了新增字段的值'&lt;/span&gt; where &lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 3&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
Query OK, 1 row affected &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Rows matched: 1  Changed: 1  Warnings: 0

mysql&amp;gt; update tb_recovery_test &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;column2 &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'修改了column2字段的值'&lt;/span&gt; where &lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 2&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
Query OK, 1 row affected &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.01 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Rows matched: 1  Changed: 1  Warnings: 0

mysql&amp;gt; &lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; from tb_recovery_test&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
+----+-------------------------------------------------+-------------------------+-----------------+
| &lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt; | column1                                         | column2                 | column3         |
+----+-------------------------------------------------+-------------------------+-----------------+
|  2 | 数据操作需谨慎,定期备份数据,什么都有就是没有后悔药       | 修改了column2字段的值     | NULL            |
|  3 | 新增了一个字段                                     | 新增了一个字段            | 修改了新增字段的值 |
+----+--------------------------------------------------+------------------------+-----------------+
2 rows &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;4，最后我误操作，把表&lt;code class=&quot;highlighter-rouge&quot;&gt;tb_recovery_test&lt;/code&gt;删除&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;drop&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;table&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tb_recovery_test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;运行结果：&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql&amp;gt; drop table tb_recovery_test&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
Query OK, 0 rows affected &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.03 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;显然，最后一步操作之后，我们之前所做的操作白费了，还好我们开启了&lt;code class=&quot;highlighter-rouge&quot;&gt;log_bin&lt;/code&gt;功能，通过日志来找回误操作删除的数据&lt;/p&gt;

&lt;h2 id=&quot;通过日志文件恢复-tb_recovery_test-数据&quot;&gt;通过日志文件恢复 tb_recovery_test 数据&lt;/h2&gt;

&lt;p&gt;进入到mysql保存日志的目录，通过前面配置可以知道日志文件保存在 &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/log/mysql/&lt;/code&gt; 下&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;thxopen@Thxopen:/var/log/mysql&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /var/log/mysql/
thxopen@Thxopen:/var/log/mysql&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls
&lt;/span&gt;error.log  mysql-bin.000001  mysql-bin.000002  mysql-bin.000003  mysql-bin.000004  mysql-bin.index
thxopen@Thxopen:/var/log/mysql&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ll
总用量 364164
drwxr-x--- 1 mysql adm          512 8月  29 10:06 ./
drwxrwxr-x 1 root  syslog       512 11月 18  2017 ../
&lt;span class=&quot;nt&quot;&gt;-rw-r-----&lt;/span&gt; 1 mysql adm    108427282 8月  29 10:13 error.log
&lt;span class=&quot;nt&quot;&gt;-rw-r-----&lt;/span&gt; 1 mysql mysql        154 8月  28 19:37 mysql-bin.000001
&lt;span class=&quot;nt&quot;&gt;-rw-r-----&lt;/span&gt; 1 mysql mysql        177 8月  28 19:55 mysql-bin.000002
&lt;span class=&quot;nt&quot;&gt;-rw-r-----&lt;/span&gt; 1 mysql mysql  264390804 8月  29 10:06 mysql-bin.000003
&lt;span class=&quot;nt&quot;&gt;-rw-r-----&lt;/span&gt; 1 mysql mysql       3411 8月  29 13:14 mysql-bin.000004
&lt;span class=&quot;nt&quot;&gt;-rw-r-----&lt;/span&gt; 1 mysql mysql        128 8月  29 10:06 mysql-bin.index
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;从列出的文件可以看出 &lt;code class=&quot;highlighter-rouge&quot;&gt;mysql-bin.000004&lt;/code&gt; 文件是最近改动的，一般来说文件的后缀是增长的，根据实际情况，这里我选择最后一个日志文件进行恢复操作&lt;/p&gt;

&lt;p&gt;执行导出日志操作，先看看导出的sql具体是什么样的&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;mysqlbinlog &lt;span class=&quot;nt&quot;&gt;--base64-output&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;decode-rows /var/log/mysql/mysql-bin.000004 &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; ./recovery-decode.sql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ps: 添加&lt;code class=&quot;highlighter-rouge&quot;&gt;--base64-output=decode-rows&lt;/code&gt; 参数导出的sql文件里不包含数据部分（即insert，delete，update），主要是方便分析，实际导出的
sql是&lt;strong&gt;不能&lt;/strong&gt;加这个参数的&lt;/p&gt;

&lt;p&gt;查看导出sql，我截取了文件的开头和结尾部分，中间部分省略&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;50530 SET @@SESSION.PSEUDO_SLAVE_MODE&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;50003 SET @OLD_COMPLETION_TYPE&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;@@COMPLETION_TYPE,COMPLETION_TYPE&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
DELIMITER /&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# at 4&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#180829 10:06:42 server id 1  end_log_pos 123 CRC32 0xa3922cf1 	Start: binlog v 4, server v 5.7.22-0ubuntu0.16.04.1-log created 180829 10:06:42 at startup&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Warning: this binlog is either in use or was not closed properly.&lt;/span&gt;
ROLLBACK/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# at 123&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#180829 10:06:43 server id 1  end_log_pos 154 CRC32 0xa18892ca 	Previous-GTIDs&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# [empty]&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# at 154&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#180829 13:07:48 server id 1  end_log_pos 219 CRC32 0x7e4bd4d6 	Anonymous_GTID	last_committed=0	sequence_number=1	rbr_only=no&lt;/span&gt;
SET @@SESSION.GTID_NEXT&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'ANONYMOUS'&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# at 219&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#180829 13:07:48 server id 1  end_log_pos 425 CRC32 0x331aefcb 	Query	thread_id=15	exec_time=0	error_code=0&lt;/span&gt;
use &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;thxopen&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
SET &lt;span class=&quot;nv&quot;&gt;TIMESTAMP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1535519268/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
SET @@session.pseudo_thread_id&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;15/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
SET @@session.foreign_key_checks&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1, @@session.sql_auto_is_null&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0, @@session.unique_checks&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1, @@session.autocommit&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
SET @@session.sql_mode&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1436549152/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
SET @@session.auto_increment_increment&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1, @@session.auto_increment_offset&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\C&lt;/span&gt; utf8 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;//&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
SET @@session.character_set_client&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33,@@session.collation_connection&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33,@@session.collation_server&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;8/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
SET @@session.lc_time_names&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
SET @@session.collation_database&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;DEFAULT/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
create table tb_recovery_test
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;id &lt;/span&gt;int not null ,
  column1 varchar&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;32&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;          null,
  column2 varchar&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;32&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;          null
&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# at 425&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#省略了中间的内容&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#省略了中间的内容&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#省略了中间的内容&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#省略了中间的内容&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# at 1970&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#180829 13:10:10 server id 1  end_log_pos 2035 CRC32 0x8c8ac254 	Anonymous_GTID	last_committed=6	sequence_number=7	rbr_only=yes&lt;/span&gt;
/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;50718 SET TRANSACTION ISOLATION LEVEL READ COMMITTED&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;//&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
SET @@SESSION.GTID_NEXT&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'ANONYMOUS'&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# at 2035&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#180829 13:10:10 server id 1  end_log_pos 2110 CRC32 0x1d22149c 	Query	thread_id=15	exec_time=0	error_code=0&lt;/span&gt;
SET &lt;span class=&quot;nv&quot;&gt;TIMESTAMP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1535519410/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
BEGIN
/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# at 2110&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#180829 13:10:10 server id 1  end_log_pos 2181 CRC32 0xcccc7fab 	Table_map: `thxopen`.`tb_recovery_test` mapped to number 168&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# at 2181&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#180829 13:10:10 server id 1  end_log_pos 2287 CRC32 0x322b3ff6 	Write_rows: table id 168 flags: STMT_END_F&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# at 2287&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#180829 13:10:10 server id 1  end_log_pos 2318 CRC32 0xaa8d7acf 	Xid = 3075&lt;/span&gt;
COMMIT/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# at 2318&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#180829 13:10:10 server id 1  end_log_pos 2383 CRC32 0x05b7bd59 	Anonymous_GTID	last_committed=7	sequence_number=8	rbr_only=yes&lt;/span&gt;
/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;50718 SET TRANSACTION ISOLATION LEVEL READ COMMITTED&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;//&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
SET @@SESSION.GTID_NEXT&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'ANONYMOUS'&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# at 2383&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#180829 13:10:10 server id 1  end_log_pos 2458 CRC32 0x171d4eab 	Query	thread_id=15	exec_time=0	error_code=0&lt;/span&gt;
SET &lt;span class=&quot;nv&quot;&gt;TIMESTAMP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1535519410/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
BEGIN
/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# at 2458&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#180829 13:10:10 server id 1  end_log_pos 2529 CRC32 0xe95d3272 	Table_map: `thxopen`.`tb_recovery_test` mapped to number 168&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# at 2529&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#180829 13:10:10 server id 1  end_log_pos 2713 CRC32 0x4386d86f 	Update_rows: table id 168 flags: STMT_END_F&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# at 2713&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#180829 13:10:10 server id 1  end_log_pos 2744 CRC32 0xcde5fff8 	Xid = 3076&lt;/span&gt;
COMMIT/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# at 2744&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#180829 13:10:19 server id 1  end_log_pos 2809 CRC32 0x3b9cc08b 	Anonymous_GTID	last_committed=8	sequence_number=9	rbr_only=yes&lt;/span&gt;
/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;50718 SET TRANSACTION ISOLATION LEVEL READ COMMITTED&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;//&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
SET @@SESSION.GTID_NEXT&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'ANONYMOUS'&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# at 2809&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#180829 13:10:19 server id 1  end_log_pos 2884 CRC32 0xb86bbce3 	Query	thread_id=15	exec_time=0	error_code=0&lt;/span&gt;
SET &lt;span class=&quot;nv&quot;&gt;TIMESTAMP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1535519419/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
BEGIN
/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# at 2884&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#180829 13:10:19 server id 1  end_log_pos 2955 CRC32 0x7b3dc472 	Table_map: `thxopen`.`tb_recovery_test` mapped to number 168&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# at 2955&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#180829 13:10:19 server id 1  end_log_pos 3180 CRC32 0x1ff6807f 	Update_rows: table id 168 flags: STMT_END_F&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# at 3180&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#180829 13:10:19 server id 1  end_log_pos 3211 CRC32 0xda138c1f 	Xid = 3077&lt;/span&gt;
COMMIT/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# at 3211&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#180829 13:14:00 server id 1  end_log_pos 3276 CRC32 0x9e823905 	Anonymous_GTID	last_committed=9	sequence_number=10	rbr_only=no&lt;/span&gt;
SET @@SESSION.GTID_NEXT&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'ANONYMOUS'&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# at 3276&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#180829 13:14:00 server id 1  end_log_pos 3411 CRC32 0x2f9c474a 	Query	thread_id=15	exec_time=0	error_code=0&lt;/span&gt;
SET &lt;span class=&quot;nv&quot;&gt;TIMESTAMP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1535519640/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
DROP TABLE &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;tb_recovery_test&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt; /&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; generated by server &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/
/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
SET @@SESSION.GTID_NEXT&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'AUTOMATIC'&lt;/span&gt; /&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; added by mysqlbinlog &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/ /&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
DELIMITER &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# End of log file&lt;/span&gt;
/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;50003 SET &lt;span class=&quot;nv&quot;&gt;COMPLETION_TYPE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;@OLD_COMPLETION_TYPE&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;50530 SET @@SESSION.PSEUDO_SLAVE_MODE&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;从文件里可以看出我一开始的建表语句，也就是我每一步操作都记录在这个日志里，那么我只要把我之前的每一步都再执行一边，数据就能恢复回来，我们按照这个思路操作&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;1，先确定起始position，这里我选择 &lt;code class=&quot;highlighter-rouge&quot;&gt;end_log_pos 219&lt;/code&gt; ，前面参数解释了，起始点是不包含的所以要选建表语句之前的操作点（也可以选择起始时间 &lt;code class=&quot;highlighter-rouge&quot;&gt;180829 13:07:48&lt;/code&gt;）&lt;/li&gt;
  &lt;li&gt;2，确定截止position &lt;code class=&quot;highlighter-rouge&quot;&gt;end_log_pos 3276&lt;/code&gt; 或截止时间 &lt;code class=&quot;highlighter-rouge&quot;&gt;180829 13:14:00&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;3，导出恢复数据sql&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#使用position导出sql&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;mysqlbinlog &lt;span class=&quot;nt&quot;&gt;--start-position&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;219 &lt;span class=&quot;nt&quot;&gt;--stop-position&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;3276 /var/log/mysql/mysql-bin.000004 &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; ./recovery-restore.sql
&lt;span class=&quot;c&quot;&gt;#使用时间导出sql&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;mysqlbinlog &lt;span class=&quot;nt&quot;&gt;--start-datetime&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'2018-08-29 13:07:48'&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--stop-datetime&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'2018-08-29 13:14:00'&lt;/span&gt; /var/log/mysql/mysql-bin.000004 &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; ./recovery-restore.sql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;下面为导出的sql前半部分，可以看到&lt;code class=&quot;highlighter-rouge&quot;&gt;BINLOG&lt;/code&gt;后面有base64的字符，这个就是对数据的操作&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;50530 SET @@SESSION.PSEUDO_SLAVE_MODE&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;50003 SET @OLD_COMPLETION_TYPE&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;@@COMPLETION_TYPE,COMPLETION_TYPE&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
DELIMITER /&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# at 4&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#180829 10:06:42 server id 1  end_log_pos 123 CRC32 0xa3922cf1 	Start: binlog v 4, server v 5.7.22-0ubuntu0.16.04.1-log created 180829 10:06:42 at startup&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Warning: this binlog is either in use or was not closed properly.&lt;/span&gt;
ROLLBACK/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
BINLOG &lt;span class=&quot;s1&quot;&gt;'
sv+FWw8BAAAAdwAAAHsAAAABAAQANS43LjIyLTB1YnVudHUwLjE2LjA0LjEtbG9nAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAACy/4VbEzgNAAgAEgAEBAQEEgAAXwAEGggAAAAICAgCAAAACgoKKioAEjQA
AfEskqM=
'&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# at 219&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#180829 13:07:48 server id 1  end_log_pos 425 CRC32 0x331aefcb 	Query	thread_id=15	exec_time=0	error_code=0&lt;/span&gt;
use &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;thxopen&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
SET &lt;span class=&quot;nv&quot;&gt;TIMESTAMP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1535519268/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
SET @@session.pseudo_thread_id&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;15/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
SET @@session.foreign_key_checks&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1, @@session.sql_auto_is_null&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0, @@session.unique_checks&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1, @@session.autocommit&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
SET @@session.sql_mode&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1436549152/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
SET @@session.auto_increment_increment&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1, @@session.auto_increment_offset&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\C&lt;/span&gt; utf8 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;//&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
SET @@session.character_set_client&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33,@@session.collation_connection&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33,@@session.collation_server&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;8/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
SET @@session.lc_time_names&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
SET @@session.collation_database&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;DEFAULT/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
create table tb_recovery_test
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;id &lt;/span&gt;int not null ,
  column1 varchar&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;32&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;          null,
  column2 varchar&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;32&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;          null
&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# at 425&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;#省略了后面的&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#省略了后面的&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#省略了后面的&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#省略了后面的&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;4，导入sql到数据库&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql &lt;span class=&quot;nt&quot;&gt;-uroot&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; database_name &amp;lt; recovery-restore.sql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ps：还可以加入[-f] 参数，强制执行，即忽略所有错误，根据实际情况使用这个参数&lt;/p&gt;

&lt;p&gt;运行结果：&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;thxopen@Thxopen:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;mysql &lt;span class=&quot;nt&quot;&gt;-uroot&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; thxopen &amp;lt; recovery-restore.sql
Enter password:
thxopen@Thxopen:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;mysql &lt;span class=&quot;nt&quot;&gt;-uroot&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt;
Enter password:
Welcome to the MySQL monitor.  Commands end with &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; or &lt;span class=&quot;se&quot;&gt;\g&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Your MySQL connection &lt;span class=&quot;nb&quot;&gt;id &lt;/span&gt;is 17
Server version: 5.7.22-0ubuntu0.16.04.1-log &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

Copyright &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 2000, 2018, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type &lt;span class=&quot;s1&quot;&gt;'help;'&lt;/span&gt; or &lt;span class=&quot;s1&quot;&gt;'\h'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;help. Type &lt;span class=&quot;s1&quot;&gt;'\c'&lt;/span&gt; to clear the current input statement.

mysql&amp;gt; use thxopen&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
Reading table information &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;completion of table and column names
You can turn off this feature to get a quicker startup with &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt;

Database changed
mysql&amp;gt; show tables&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
+-------------------+
| Tables_in_thxopen |
+-------------------+
| tb_recovery_test  |
+-------------------+
1 row &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

mysql&amp;gt; &lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; from tb_recovery_test&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
+----+----------------------------------------------+------------------------+------------------+
| &lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt; | column1                                      | column2                | column3          |
+----+----------------------------------------------+------------------------+------------------+
|  2 | 数据操作需谨慎,定期备份数据,什么都有就是没有后悔药    | 修改了column2字段的值    | NULL             |
|  3 | 新增了一个字段                                  | 新增了一个字段           | 修改了新增字段的值  |
+----+----------------------------------------------+------------------------+------------------+
2 rows &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

mysql&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;导入之后，重新登录到mysql，查看表，查看数据，已经恢复到drop之前的状态了，到此大功告成，数据恢复成功！&lt;/p&gt;

&lt;h2 id=&quot;导入恢复数据到数据库可能会遇到的错误&quot;&gt;导入恢复数据到数据库可能会遇到的错误&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Duplicate entry 重复的实体，出现此错误代表恢复的sql脚本里，包含创建了实体的语句，重新执行一边，则报错&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Duplicate column name 重复的列名称，理由同上&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Duplicate key name 重复的键索引，理由同上&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Can’t find record in ‘table_name’ 由于业务逻辑，有些数据删除，修改，新增，删除，修改反复这样操作，导致恢复的时候出现此错误&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Cannot add or update a child row: a foreign key constraint fails (&lt;code class=&quot;highlighter-rouge&quot;&gt;thxopen&lt;/code&gt;.&lt;code class=&quot;highlighter-rouge&quot;&gt;tb_recovery_test&lt;/code&gt;, CONSTRAINT &lt;code class=&quot;highlighter-rouge&quot;&gt;FKan5m1ygnxb4ibmq1ncqklji26&lt;/code&gt; FOREIGN KEY (&lt;code class=&quot;highlighter-rouge&quot;&gt;rid&lt;/code&gt;) REFERENCES &lt;code class=&quot;highlighter-rouge&quot;&gt;tb_recovery_relate&lt;/code&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;id&lt;/code&gt;))
由于外键关联，修改表的数据在另一个表中不存在导致&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Table ‘table_name’ already exists 重复的表，恢复sql脚本了包含数据库里已经存在的表&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Can’t write; duplicate key in table 创建表的外键名称重复了&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;MySQL server has gone away 由于导入的恢复sql太大，超过了mysql的限制，需要修改配置文件&lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/mysql/mysql.conf.d/mysqld.cnf&lt;/code&gt; 里 &lt;code class=&quot;highlighter-rouge&quot;&gt;max_allowed_packet = 16M&lt;/code&gt; 配置，根据实际情况调大一些&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;总结&quot;&gt;总结&lt;/h2&gt;

&lt;p&gt;对于文中的例子，恢复数据是100%的，但是在实际的项目中，虽然开启了&lt;code class=&quot;highlighter-rouge&quot;&gt;log_bin&lt;/code&gt;，
但不能想着万事大吉就不管了，我就是惨痛的经历，数据感觉50%都没恢复到。简直是血的教训，血的教训，血的教训啊~&lt;/p&gt;

&lt;p&gt;不过从这个也可以看出系统设计本身的问题，逻辑复杂，耦合度高，关联性太强，比如我误删的数据，
由于表之间的关系比较复杂，恢复出来的数据有很多问题。&lt;/p&gt;

&lt;p&gt;主要是如下几个问题：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;手动在Intellij Database Console执行的update语句，在恢复之后没有体现出来，字段是null&lt;/li&gt;
  &lt;li&gt;部分表的数据完全没有，一条数据也没有&lt;/li&gt;
  &lt;li&gt;由于我是覆盖数据，都是先drop表，然后又create了表，而日志文件又没有从最开始创建表的，
所以执行恢复sql的时候，报了如上列出的所有error，对于重复表，重复字段这些，我把日志里的删除，可以解决，
但是对于数据的关联出错，找不到记录的就太多了，没有办法一一修复，为了执行完成sql，导入的时候加了[-f]参数，忽略所有错误&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;因为上面这些问题，加上日志本身也不全，导致数据根本没法100%的恢复&lt;/p&gt;

&lt;p&gt;说了这么多，还是一句话，&lt;strong&gt;没有规矩，不成方圆&lt;/strong&gt;，做事要小心谨慎，按照一定的流程做事就可以减少犯错误的几率。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;定期备份数据，操作数据谨慎&lt;/strong&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Reference&lt;/p&gt;
  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;https://www.cnblogs.com/cenalulu/archive/2013/01/08/2850820.html&quot;&gt;https://www.cnblogs.com/cenalulu/archive/2013/01/08/2850820.html&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;https://blog.csdn.net/leshami/article/details/41962243&quot;&gt;https://blog.csdn.net/leshami/article/details/41962243&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;http://www.unixfbi.com/499.html&quot;&gt;http://www.unixfbi.com/499.html&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;http://blog.51cto.com/suifu/1845457&quot;&gt;http://blog.51cto.com/suifu/1845457&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;https://www.cnblogs.com/leezhxing/p/3347610.html&quot;&gt;https://www.cnblogs.com/leezhxing/p/3347610.html&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;http://www.hankcs.com/appos/database/mysql-restore-dropped-table.html&quot;&gt;http://www.hankcs.com/appos/database/mysql-restore-dropped-table.html&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;https://blog.csdn.net/weixin_41004350/article/details/78547005&quot;&gt;https://blog.csdn.net/weixin_41004350/article/details/78547005&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;https://blog.csdn.net/xyz846/article/details/52210542&quot;&gt;https://blog.csdn.net/xyz846/article/details/52210542&lt;/a&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;</content><author><name>单思义</name><email>keith@thxopen.com</email></author><category term="mysql" /><category term="mysqlbinlog" /><category term="drop" /><category term="ubuntu" /><summary type="html">背景 我肯定跟mysql过不去，覆盖数据在我身上已经发生了2次了，难道我这是上演从删库到跑路么？ 在上次覆盖了数据之后，我就告诉自己操作数据库先备份，即便错了也可以恢复，这次操作之前我已经很谨慎了，可惜最后还是做错了。 同事辛苦几周操作的数据被我一秒钟给覆盖了，我没有着急，我淡定，我回想上次误操作后，打开了mysql的日志功能，据说可以一定程度的恢复数据， 这次我来验证一下，通过我几个小时的挣扎，数据恢复过来，但从结果来看，并不是100%的恢复了，没办法，只能再花时间精力把数据重新来过。 只可惜什么都有就是没有后悔药，写下此篇，引以为戒，数据一定一定一定要备份！！！操作一定一定一定要谨慎！！！ 虽然没有100%的恢复，但是如果没有开启log_bin那一定就恢复不了了，至少还有个救命稻草，下文介绍如何使用mysqlbinlog命令恢复drop后的数据 查看mysql日志是否开启 进入mysql的配置目录，一般在/etc/mysql/mysql.conf.d目录里面，有如下两个文件 thxopen@Thxopen:/etc/mysql/mysql.conf.d$ ls mysqld.cnf mysqld_safe_syslog.cnf 编辑mysqld.cnf文件，找到log_bin配置 # The following can be used as easy to replay backup logs or for replication. # note: if you are setting up a replication slave, see README.Debian about # other settings you may need to change. server-id = 1 log_bin = /var/log/mysql/mysql-bin.log expire_logs_days = 10 max_binlog_size = 500M 默认情况下log_bin功能是关闭的，把 server-id 和 log_bin 取消注释，保存退出，重启mysql即可。 查找 mysql 日志文件 根据log_bin配置的日志目录，我找到了日志 thxopen@Thxopen:/etc/mysql/mysql.conf.d$ cd /var/log/mysql/ thxopen@Thxopen:/var/log/mysql$ ls error.log mysql-bin.000001 mysql-bin.000002 mysql-bin.000003 mysql-bin.000004 mysql-bin.index thxopen@Thxopen:/var/log/mysql$ ll 总用量 364160 drwxr-x--- 1 mysql adm 512 8月 29 10:06 ./ drwxrwxr-x 1 root syslog 512 11月 18 2017 ../ -rw-r----- 1 mysql adm 108427282 8月 29 10:13 error.log -rw-r----- 1 mysql mysql 154 8月 28 19:37 mysql-bin.000001 -rw-r----- 1 mysql mysql 177 8月 28 19:55 mysql-bin.000002 -rw-r----- 1 mysql mysql 264390804 8月 29 10:06 mysql-bin.000003 -rw-r----- 1 mysql mysql 154 8月 29 10:06 mysql-bin.000004 -rw-r----- 1 mysql mysql 128 8月 29 10:06 mysql-bin.index mysql-bin.000001 即为我们需要的日志文件，使用mysqlbinlog命令可以导出可执行的sql文件 mysqlbinlog 介绍 像一般的系统一样，我们会对系统的每一个操作记录下操作日志，而log_bin就是对数据库的每一个操作记录下的一个二进制的日志，里面包含了我们 所有执行的sql语句。 通过此命令，我们可以导出我们操作的sql语句，这样达到恢复数据的目的。 关于mysqlbinlog命令几个常使用的参数，可以帮助我们更快的找到我们的数据 --start-position 起始位置（不包含） --stop-position 截止位置 --start-datetime 起始时间 --stop-datetime 截止时间 --base64-output=decode-rows 输出的文件base64解码 更多关于mysqlbinlog的参数可以通过参数--help获取 模拟实际的操作，新增数据，修改数据，删除表，恢复数据 1，创建一张测试表 create table tb_recovery_test ( id int not null , column1 varchar(32) null, column2 varchar(32) null ); 运行结果： mysql&amp;gt; create table tb_recovery_test -&amp;gt; ( -&amp;gt; id int not null , -&amp;gt; column1 varchar(32) null, -&amp;gt; column2 varchar(32) null -&amp;gt; ); Query OK, 0 rows affected (0.05 sec) 2，插入测试数据 insert into tb_recovery_test (id,column1,column2) values (1,'数据操作需谨慎','定期备份数据'); insert into tb_recovery_test (id,column1,column2) values (2,'后悔了','可是没有后悔药'); 运行结果： mysql&amp;gt; insert into tb_recovery_test (id,column1,column2) -&amp;gt; values (1,'数据操作需谨慎','定期备份数据'); Query OK, 1 row affected (0.01 sec) mysql&amp;gt; insert into tb_recovery_test (id,column1,column2) -&amp;gt; values (2,'后悔了','可是没有后悔药'); Query OK, 1 row affected (0.01 sec) mysql&amp;gt; select * from tb_recovery_test; +----+--------------+-------------------+ | id | column1 | column2 | +----+--------------+-------------------+ | 1 | 数据操作需谨慎 | 定期备份数据 | | 2 | 后悔了 | 可是没有后悔药 | +----+--------------+-------------------+ 2 rows in set (0.00 sec) 3，修改数据，这里模拟一下真实的场景，对数据进行修改，删除，添加字段操作 update tb_recovery_test set column1 = '数据操作需谨慎,定期备份数据,什么都有就是没有后悔药', column2 = null where id = 2; delete from tb_recovery_test where id = 1; ALTER TABLE tb_recovery_test ADD column3 varchar(32) NULL; insert into tb_recovery_test (id,column1,column2,column3) values (3,'新增了一个字段','新增了一个字段','新增了一个字段'); update tb_recovery_test set column3 = '修改了新增字段的值' where id = 3; update tb_recovery_test set column2 = '修改了column2字段的值' where id = 2; 运行结果： mysql&amp;gt; update tb_recovery_test set column1 = '数据操作需谨慎,定期备份数据,什么都有就是没有后悔药', -&amp;gt; column2 = null -&amp;gt; where id = 2; Query OK, 1 row affected (0.01 sec) Rows matched: 1 Changed: 1 Warnings: 0 mysql&amp;gt; delete from tb_recovery_test where id = 1; Query OK, 1 row affected (0.00 sec) mysql&amp;gt; ALTER TABLE tb_recovery_test ADD column3 varchar(32) NULL; Query OK, 0 rows affected (0.10 sec) Records: 0 Duplicates: 0 Warnings: 0 mysql&amp;gt; insert into tb_recovery_test (id,column1,column2,column3) -&amp;gt; values (3,'新增了一个字段','新增了一个字段','新增了一个字段'); Query OK, 1 row affected (0.01 sec) mysql&amp;gt; update tb_recovery_test set column3 = '修改了新增字段的值' where id = 3; Query OK, 1 row affected (0.00 sec) Rows matched: 1 Changed: 1 Warnings: 0 mysql&amp;gt; update tb_recovery_test set column2 = '修改了column2字段的值' where id = 2; Query OK, 1 row affected (0.01 sec) Rows matched: 1 Changed: 1 Warnings: 0 mysql&amp;gt; select * from tb_recovery_test; +----+-------------------------------------------------+-------------------------+-----------------+ | id | column1 | column2 | column3 | +----+-------------------------------------------------+-------------------------+-----------------+ | 2 | 数据操作需谨慎,定期备份数据,什么都有就是没有后悔药 | 修改了column2字段的值 | NULL | | 3 | 新增了一个字段 | 新增了一个字段 | 修改了新增字段的值 | +----+--------------------------------------------------+------------------------+-----------------+ 2 rows in set (0.00 sec) 4，最后我误操作，把表tb_recovery_test删除 drop table tb_recovery_test; 运行结果： mysql&amp;gt; drop table tb_recovery_test; Query OK, 0 rows affected (0.03 sec) 显然，最后一步操作之后，我们之前所做的操作白费了，还好我们开启了log_bin功能，通过日志来找回误操作删除的数据 通过日志文件恢复 tb_recovery_test 数据 进入到mysql保存日志的目录，通过前面配置可以知道日志文件保存在 /var/log/mysql/ 下 thxopen@Thxopen:/var/log/mysql$ cd /var/log/mysql/ thxopen@Thxopen:/var/log/mysql$ ls error.log mysql-bin.000001 mysql-bin.000002 mysql-bin.000003 mysql-bin.000004 mysql-bin.index thxopen@Thxopen:/var/log/mysql$ ll 总用量 364164 drwxr-x--- 1 mysql adm 512 8月 29 10:06 ./ drwxrwxr-x 1 root syslog 512 11月 18 2017 ../ -rw-r----- 1 mysql adm 108427282 8月 29 10:13 error.log -rw-r----- 1 mysql mysql 154 8月 28 19:37 mysql-bin.000001 -rw-r----- 1 mysql mysql 177 8月 28 19:55 mysql-bin.000002 -rw-r----- 1 mysql mysql 264390804 8月 29 10:06 mysql-bin.000003 -rw-r----- 1 mysql mysql 3411 8月 29 13:14 mysql-bin.000004 -rw-r----- 1 mysql mysql 128 8月 29 10:06 mysql-bin.index 从列出的文件可以看出 mysql-bin.000004 文件是最近改动的，一般来说文件的后缀是增长的，根据实际情况，这里我选择最后一个日志文件进行恢复操作 执行导出日志操作，先看看导出的sql具体是什么样的 sudo mysqlbinlog --base64-output=decode-rows /var/log/mysql/mysql-bin.000004 &amp;gt; ./recovery-decode.sql ps: 添加--base64-output=decode-rows 参数导出的sql文件里不包含数据部分（即insert，delete，update），主要是方便分析，实际导出的 sql是不能加这个参数的 查看导出sql，我截取了文件的开头和结尾部分，中间部分省略 /*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/; /*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/; DELIMITER /*!*/; # at 4 #180829 10:06:42 server id 1 end_log_pos 123 CRC32 0xa3922cf1 Start: binlog v 4, server v 5.7.22-0ubuntu0.16.04.1-log created 180829 10:06:42 at startup # Warning: this binlog is either in use or was not closed properly. ROLLBACK/*!*/; # at 123 #180829 10:06:43 server id 1 end_log_pos 154 CRC32 0xa18892ca Previous-GTIDs # [empty] # at 154 #180829 13:07:48 server id 1 end_log_pos 219 CRC32 0x7e4bd4d6 Anonymous_GTID last_committed=0 sequence_number=1 rbr_only=no SET @@SESSION.GTID_NEXT= 'ANONYMOUS'/*!*/; # at 219 #180829 13:07:48 server id 1 end_log_pos 425 CRC32 0x331aefcb Query thread_id=15 exec_time=0 error_code=0 use `thxopen`/*!*/; SET TIMESTAMP=1535519268/*!*/; SET @@session.pseudo_thread_id=15/*!*/; SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/*!*/; SET @@session.sql_mode=1436549152/*!*/; SET @@session.auto_increment_increment=1, @@session.auto_increment_offset=1/*!*/; /*!\C utf8 *//*!*/; SET @@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=8/*!*/; SET @@session.lc_time_names=0/*!*/; SET @@session.collation_database=DEFAULT/*!*/; create table tb_recovery_test ( id int not null , column1 varchar(32) null, column2 varchar(32) null ) /*!*/; # at 425 #省略了中间的内容 #省略了中间的内容 #省略了中间的内容 #省略了中间的内容 # at 1970 #180829 13:10:10 server id 1 end_log_pos 2035 CRC32 0x8c8ac254 Anonymous_GTID last_committed=6 sequence_number=7 rbr_only=yes /*!50718 SET TRANSACTION ISOLATION LEVEL READ COMMITTED*//*!*/; SET @@SESSION.GTID_NEXT= 'ANONYMOUS'/*!*/; # at 2035 #180829 13:10:10 server id 1 end_log_pos 2110 CRC32 0x1d22149c Query thread_id=15 exec_time=0 error_code=0 SET TIMESTAMP=1535519410/*!*/; BEGIN /*!*/; # at 2110 #180829 13:10:10 server id 1 end_log_pos 2181 CRC32 0xcccc7fab Table_map: `thxopen`.`tb_recovery_test` mapped to number 168 # at 2181 #180829 13:10:10 server id 1 end_log_pos 2287 CRC32 0x322b3ff6 Write_rows: table id 168 flags: STMT_END_F # at 2287 #180829 13:10:10 server id 1 end_log_pos 2318 CRC32 0xaa8d7acf Xid = 3075 COMMIT/*!*/; # at 2318 #180829 13:10:10 server id 1 end_log_pos 2383 CRC32 0x05b7bd59 Anonymous_GTID last_committed=7 sequence_number=8 rbr_only=yes /*!50718 SET TRANSACTION ISOLATION LEVEL READ COMMITTED*//*!*/; SET @@SESSION.GTID_NEXT= 'ANONYMOUS'/*!*/; # at 2383 #180829 13:10:10 server id 1 end_log_pos 2458 CRC32 0x171d4eab Query thread_id=15 exec_time=0 error_code=0 SET TIMESTAMP=1535519410/*!*/; BEGIN /*!*/; # at 2458 #180829 13:10:10 server id 1 end_log_pos 2529 CRC32 0xe95d3272 Table_map: `thxopen`.`tb_recovery_test` mapped to number 168 # at 2529 #180829 13:10:10 server id 1 end_log_pos 2713 CRC32 0x4386d86f Update_rows: table id 168 flags: STMT_END_F # at 2713 #180829 13:10:10 server id 1 end_log_pos 2744 CRC32 0xcde5fff8 Xid = 3076 COMMIT/*!*/; # at 2744 #180829 13:10:19 server id 1 end_log_pos 2809 CRC32 0x3b9cc08b Anonymous_GTID last_committed=8 sequence_number=9 rbr_only=yes /*!50718 SET TRANSACTION ISOLATION LEVEL READ COMMITTED*//*!*/; SET @@SESSION.GTID_NEXT= 'ANONYMOUS'/*!*/; # at 2809 #180829 13:10:19 server id 1 end_log_pos 2884 CRC32 0xb86bbce3 Query thread_id=15 exec_time=0 error_code=0 SET TIMESTAMP=1535519419/*!*/; BEGIN /*!*/; # at 2884 #180829 13:10:19 server id 1 end_log_pos 2955 CRC32 0x7b3dc472 Table_map: `thxopen`.`tb_recovery_test` mapped to number 168 # at 2955 #180829 13:10:19 server id 1 end_log_pos 3180 CRC32 0x1ff6807f Update_rows: table id 168 flags: STMT_END_F # at 3180 #180829 13:10:19 server id 1 end_log_pos 3211 CRC32 0xda138c1f Xid = 3077 COMMIT/*!*/; # at 3211 #180829 13:14:00 server id 1 end_log_pos 3276 CRC32 0x9e823905 Anonymous_GTID last_committed=9 sequence_number=10 rbr_only=no SET @@SESSION.GTID_NEXT= 'ANONYMOUS'/*!*/; # at 3276 #180829 13:14:00 server id 1 end_log_pos 3411 CRC32 0x2f9c474a Query thread_id=15 exec_time=0 error_code=0 SET TIMESTAMP=1535519640/*!*/; DROP TABLE `tb_recovery_test` /* generated by server */ /*!*/; SET @@SESSION.GTID_NEXT= 'AUTOMATIC' /* added by mysqlbinlog */ /*!*/; DELIMITER ; # End of log file /*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/; /*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/; 从文件里可以看出我一开始的建表语句，也就是我每一步操作都记录在这个日志里，那么我只要把我之前的每一步都再执行一边，数据就能恢复回来，我们按照这个思路操作 1，先确定起始position，这里我选择 end_log_pos 219 ，前面参数解释了，起始点是不包含的所以要选建表语句之前的操作点（也可以选择起始时间 180829 13:07:48） 2，确定截止position end_log_pos 3276 或截止时间 180829 13:14:00 3，导出恢复数据sql #使用position导出sql sudo mysqlbinlog --start-position=219 --stop-position=3276 /var/log/mysql/mysql-bin.000004 &amp;gt; ./recovery-restore.sql #使用时间导出sql sudo mysqlbinlog --start-datetime='2018-08-29 13:07:48' --stop-datetime='2018-08-29 13:14:00' /var/log/mysql/mysql-bin.000004 &amp;gt; ./recovery-restore.sql 下面为导出的sql前半部分，可以看到BINLOG后面有base64的字符，这个就是对数据的操作 /*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/; /*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/; DELIMITER /*!*/; # at 4 #180829 10:06:42 server id 1 end_log_pos 123 CRC32 0xa3922cf1 Start: binlog v 4, server v 5.7.22-0ubuntu0.16.04.1-log created 180829 10:06:42 at startup # Warning: this binlog is either in use or was not closed properly. ROLLBACK/*!*/; BINLOG ' sv+FWw8BAAAAdwAAAHsAAAABAAQANS43LjIyLTB1YnVudHUwLjE2LjA0LjEtbG9nAAAAAAAAAAAA AAAAAAAAAAAAAAAAAACy/4VbEzgNAAgAEgAEBAQEEgAAXwAEGggAAAAICAgCAAAACgoKKioAEjQA AfEskqM= '/*!*/; # at 219 #180829 13:07:48 server id 1 end_log_pos 425 CRC32 0x331aefcb Query thread_id=15 exec_time=0 error_code=0 use `thxopen`/*!*/; SET TIMESTAMP=1535519268/*!*/; SET @@session.pseudo_thread_id=15/*!*/; SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/*!*/; SET @@session.sql_mode=1436549152/*!*/; SET @@session.auto_increment_increment=1, @@session.auto_increment_offset=1/*!*/; /*!\C utf8 *//*!*/; SET @@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=8/*!*/; SET @@session.lc_time_names=0/*!*/; SET @@session.collation_database=DEFAULT/*!*/; create table tb_recovery_test ( id int not null , column1 varchar(32) null, column2 varchar(32) null ) /*!*/; # at 425 #省略了后面的 #省略了后面的 #省略了后面的 #省略了后面的 4，导入sql到数据库 mysql -uroot -p database_name &amp;lt; recovery-restore.sql ps：还可以加入[-f] 参数，强制执行，即忽略所有错误，根据实际情况使用这个参数 运行结果： thxopen@Thxopen:~$ mysql -uroot -p thxopen &amp;lt; recovery-restore.sql Enter password: thxopen@Thxopen:~$ mysql -uroot -p Enter password: Welcome to the MySQL monitor. Commands end with ; or \g. Your MySQL connection id is 17 Server version: 5.7.22-0ubuntu0.16.04.1-log (Ubuntu) Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\h' for help. Type '\c' to clear the current input statement. mysql&amp;gt; use thxopen; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql&amp;gt; show tables; +-------------------+ | Tables_in_thxopen | +-------------------+ | tb_recovery_test | +-------------------+ 1 row in set (0.00 sec) mysql&amp;gt; select * from tb_recovery_test; +----+----------------------------------------------+------------------------+------------------+ | id | column1 | column2 | column3 | +----+----------------------------------------------+------------------------+------------------+ | 2 | 数据操作需谨慎,定期备份数据,什么都有就是没有后悔药 | 修改了column2字段的值 | NULL | | 3 | 新增了一个字段 | 新增了一个字段 | 修改了新增字段的值 | +----+----------------------------------------------+------------------------+------------------+ 2 rows in set (0.00 sec) mysql&amp;gt; 导入之后，重新登录到mysql，查看表，查看数据，已经恢复到drop之前的状态了，到此大功告成，数据恢复成功！ 导入恢复数据到数据库可能会遇到的错误 Duplicate entry 重复的实体，出现此错误代表恢复的sql脚本里，包含创建了实体的语句，重新执行一边，则报错 Duplicate column name 重复的列名称，理由同上 Duplicate key name 重复的键索引，理由同上 Can’t find record in ‘table_name’ 由于业务逻辑，有些数据删除，修改，新增，删除，修改反复这样操作，导致恢复的时候出现此错误 Cannot add or update a child row: a foreign key constraint fails (thxopen.tb_recovery_test, CONSTRAINT FKan5m1ygnxb4ibmq1ncqklji26 FOREIGN KEY (rid) REFERENCES tb_recovery_relate (id)) 由于外键关联，修改表的数据在另一个表中不存在导致 Table ‘table_name’ already exists 重复的表，恢复sql脚本了包含数据库里已经存在的表 Can’t write; duplicate key in table 创建表的外键名称重复了 MySQL server has gone away 由于导入的恢复sql太大，超过了mysql的限制，需要修改配置文件/etc/mysql/mysql.conf.d/mysqld.cnf 里 max_allowed_packet = 16M 配置，根据实际情况调大一些 总结 对于文中的例子，恢复数据是100%的，但是在实际的项目中，虽然开启了log_bin， 但不能想着万事大吉就不管了，我就是惨痛的经历，数据感觉50%都没恢复到。简直是血的教训，血的教训，血的教训啊~ 不过从这个也可以看出系统设计本身的问题，逻辑复杂，耦合度高，关联性太强，比如我误删的数据， 由于表之间的关系比较复杂，恢复出来的数据有很多问题。 主要是如下几个问题： 手动在Intellij Database Console执行的update语句，在恢复之后没有体现出来，字段是null 部分表的数据完全没有，一条数据也没有 由于我是覆盖数据，都是先drop表，然后又create了表，而日志文件又没有从最开始创建表的， 所以执行恢复sql的时候，报了如上列出的所有error，对于重复表，重复字段这些，我把日志里的删除，可以解决， 但是对于数据的关联出错，找不到记录的就太多了，没有办法一一修复，为了执行完成sql，导入的时候加了[-f]参数，忽略所有错误 因为上面这些问题，加上日志本身也不全，导致数据根本没法100%的恢复 说了这么多，还是一句话，没有规矩，不成方圆，做事要小心谨慎，按照一定的流程做事就可以减少犯错误的几率。 定期备份数据，操作数据谨慎 Reference https://www.cnblogs.com/cenalulu/archive/2013/01/08/2850820.html https://blog.csdn.net/leshami/article/details/41962243 http://www.unixfbi.com/499.html http://blog.51cto.com/suifu/1845457 https://www.cnblogs.com/leezhxing/p/3347610.html http://www.hankcs.com/appos/database/mysql-restore-dropped-table.html https://blog.csdn.net/weixin_41004350/article/details/78547005 https://blog.csdn.net/xyz846/article/details/52210542</summary></entry><entry><title type="html">在Ubuntu下安装Redis</title><link href="http://www.thxopen.com/linux/2018/02/27/install-redis-on-ubuntu.html" rel="alternate" type="text/html" title="在Ubuntu下安装Redis" /><published>2018-02-27T00:00:00+08:00</published><updated>2018-02-27T00:00:00+08:00</updated><id>http://www.thxopen.com/linux/2018/02/27/install-redis-on-ubuntu</id><content type="html" xml:base="http://www.thxopen.com/linux/2018/02/27/install-redis-on-ubuntu.html">&lt;p&gt;Redis是一个使用ANSI C编写的开源、支持网络、基于内存、可选持久性的键值对存储数据库。&lt;/p&gt;

&lt;h2 id=&quot;安装redis&quot;&gt;安装Redis&lt;/h2&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;redis-server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;更改默认的端口&quot;&gt;更改默认的端口&lt;/h2&gt;

&lt;p&gt;redis默认的访问端口是&lt;code class=&quot;highlighter-rouge&quot;&gt;6379&lt;/code&gt;，避免端口被恶意程序使用，我们修改redis的默认端口&lt;/p&gt;

&lt;p&gt;打开配置文件&lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/redis/redis.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;vi /etc/redis/redis.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;大概在文件50行左右，有如下内容&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;ps:vi编辑器小提示：
&lt;code class=&quot;highlighter-rouge&quot;&gt;:set number&lt;/code&gt; 设置显示文件内容的行号，方便查找内容
&lt;code class=&quot;highlighter-rouge&quot;&gt;/search_content&lt;/code&gt; 斜杠加搜索内容，搜索文件里指定内容&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Accept connections on the specified port, default is 6379.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# If port 0 is specified Redis will not listen on a TCP socket.&lt;/span&gt;
port 6379
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;修改端口为自己需要的，保存退出，重启redis即可&lt;/p&gt;

&lt;h2 id=&quot;设置访问密码&quot;&gt;设置访问密码&lt;/h2&gt;

&lt;p&gt;仅仅修改了端口号还是不够的，我们还要设置密码，避免黑客有机可乘&lt;/p&gt;

&lt;p&gt;还是继续打开配置文件 &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/redis/redis.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;vi /etc/redis/redis.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;大概在390行左右，有如下内容&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;################################## SECURITY ###################################&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Require clients to issue AUTH &amp;lt;PASSWORD&amp;gt; before processing any other&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# commands.  This might be useful in environments in which you do not trust&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# others with access to the host running redis-server.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# This should stay commented out for backward compatibility and because most&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# people do not need auth (e.g. they run their own servers).&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Warning: since Redis is pretty fast an outside user can try up to&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# 150k passwords per second against a good box. This means that you should&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# use a very strong password otherwise it will be very easy to break.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#requirepass foobared&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;去掉注释，把&lt;code class=&quot;highlighter-rouge&quot;&gt;foobared&lt;/code&gt;改为自己的密码，保存退出，重启redis即可&lt;/p&gt;

&lt;h2 id=&quot;设置从任意ip访问redis服务&quot;&gt;设置从任意ip访问redis服务&lt;/h2&gt;

&lt;p&gt;默认情况下，redis只能在本地使用，通过修改配置，可以远程操作redis&lt;/p&gt;

&lt;p&gt;同上，打开配置文件 &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/redis/redis.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;vi /etc/redis/redis.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;大概在69行，有如下内容&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# By default Redis listens for connections from all the network interfaces&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# available on the server. It is possible to listen to just one or multiple&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# interfaces using the &quot;bind&quot; configuration directive, followed by one or&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# more IP addresses.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Examples:&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# bind 192.168.1.100 10.0.0.1&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;bind &lt;/span&gt;127.0.0.1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;将 &lt;code class=&quot;highlighter-rouge&quot;&gt;127.0.0.1&lt;/code&gt; 改为指定的ip地址 &lt;code class=&quot;highlighter-rouge&quot;&gt;192.168.1.100&lt;/code&gt; （允许添加多个ip，用空格隔开），即允许ip为&lt;code class=&quot;highlighter-rouge&quot;&gt;192.168.1.100&lt;/code&gt;机器访问redis服务。（推荐）&lt;/li&gt;
  &lt;li&gt;也可以将 &lt;code class=&quot;highlighter-rouge&quot;&gt;127.0.0.1&lt;/code&gt; 改为 &lt;code class=&quot;highlighter-rouge&quot;&gt;0.0.0.0&lt;/code&gt; 表示任意ip都可以访问redis服务。 （不推荐）&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;使用console连接到redis&quot;&gt;使用console连接到redis&lt;/h2&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;thxopen@Thxopen:/etc/redis&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;redis-cli &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; 6379 &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; your_password
127.0.0.1:6379&amp;gt; ping
PONG
127.0.0.1:6379&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;看到输出 &lt;code class=&quot;highlighter-rouge&quot;&gt;PONG&lt;/code&gt; 表示redis已经启动成功&lt;/p&gt;

&lt;h2 id=&quot;使用redis-desktop-manager连接到redis&quot;&gt;使用Redis Desktop Manager连接到Redis&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://redisdesktop.com/&quot;&gt;Redis Desktop Manager&lt;/a&gt; 是一个跨平台的，开源的redis桌面管理工具。使用这个工具可以很方便的操作redis。&lt;/p&gt;

&lt;p&gt;从官网选择对应平台的安装包&lt;a href=&quot;https://redisdesktop.com/download&quot;&gt;下载&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;安装完成之后打开软件，点击左上角的 【连接到Redis服务器】，填入ip地址、端口和密码，然后点击左下角【测试连接】&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/post/linux/ubuntu/redis desktop manager.png&quot; alt=&quot;redis desktop manager&quot; /&gt;&lt;/p&gt;

&lt;p&gt;如上图所示，表示你已经连接成功，你可以使用工具对redis进行操作&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/linux/2018/02/27/install-java-ee-environment-on-ubuntu.html&quot;&gt;返回目录&lt;/a&gt;&lt;/p&gt;</content><author><name>单思义</name><email>keith@thxopen.com</email></author><category term="ubuntu" /><category term="redis" /><summary type="html">Redis是一个使用ANSI C编写的开源、支持网络、基于内存、可选持久性的键值对存储数据库。 安装Redis sudo apt-get install redis-server 更改默认的端口 redis默认的访问端口是6379，避免端口被恶意程序使用，我们修改redis的默认端口 打开配置文件/etc/redis/redis.conf sudo vi /etc/redis/redis.conf 大概在文件50行左右，有如下内容 ps:vi编辑器小提示： :set number 设置显示文件内容的行号，方便查找内容 /search_content 斜杠加搜索内容，搜索文件里指定内容 # Accept connections on the specified port, default is 6379. # If port 0 is specified Redis will not listen on a TCP socket. port 6379 修改端口为自己需要的，保存退出，重启redis即可 设置访问密码 仅仅修改了端口号还是不够的，我们还要设置密码，避免黑客有机可乘 还是继续打开配置文件 /etc/redis/redis.conf sudo vi /etc/redis/redis.conf 大概在390行左右，有如下内容 ################################## SECURITY ################################### # Require clients to issue AUTH &amp;lt;PASSWORD&amp;gt; before processing any other # commands. This might be useful in environments in which you do not trust # others with access to the host running redis-server. # # This should stay commented out for backward compatibility and because most # people do not need auth (e.g. they run their own servers). # # Warning: since Redis is pretty fast an outside user can try up to # 150k passwords per second against a good box. This means that you should # use a very strong password otherwise it will be very easy to break. # #requirepass foobared 去掉注释，把foobared改为自己的密码，保存退出，重启redis即可 设置从任意ip访问redis服务 默认情况下，redis只能在本地使用，通过修改配置，可以远程操作redis 同上，打开配置文件 /etc/redis/redis.conf sudo vi /etc/redis/redis.conf 大概在69行，有如下内容 # By default Redis listens for connections from all the network interfaces # available on the server. It is possible to listen to just one or multiple # interfaces using the &quot;bind&quot; configuration directive, followed by one or # more IP addresses. # # Examples: # # bind 192.168.1.100 10.0.0.1 bind 127.0.0.1 将 127.0.0.1 改为指定的ip地址 192.168.1.100 （允许添加多个ip，用空格隔开），即允许ip为192.168.1.100机器访问redis服务。（推荐） 也可以将 127.0.0.1 改为 0.0.0.0 表示任意ip都可以访问redis服务。 （不推荐） 使用console连接到redis thxopen@Thxopen:/etc/redis$ redis-cli -p 6379 -a your_password 127.0.0.1:6379&amp;gt; ping PONG 127.0.0.1:6379&amp;gt; 看到输出 PONG 表示redis已经启动成功 使用Redis Desktop Manager连接到Redis Redis Desktop Manager 是一个跨平台的，开源的redis桌面管理工具。使用这个工具可以很方便的操作redis。 从官网选择对应平台的安装包下载 安装完成之后打开软件，点击左上角的 【连接到Redis服务器】，填入ip地址、端口和密码，然后点击左下角【测试连接】 如上图所示，表示你已经连接成功，你可以使用工具对redis进行操作 返回目录</summary></entry><entry><title type="html">在Ubuntu下安装RabbitMQ</title><link href="http://www.thxopen.com/linux/2018/02/27/install-rabbitmq-on-ubuntu.html" rel="alternate" type="text/html" title="在Ubuntu下安装RabbitMQ" /><published>2018-02-27T00:00:00+08:00</published><updated>2018-02-27T00:00:00+08:00</updated><id>http://www.thxopen.com/linux/2018/02/27/install-rabbitmq-on-ubuntu</id><content type="html" xml:base="http://www.thxopen.com/linux/2018/02/27/install-rabbitmq-on-ubuntu.html">&lt;p&gt;RabbitMQ是一套开源（MPL）的消息队列服务软件，是由 LShift 提供的一个 Advanced Message Queuing Protocol (AMQP) 
的开源实现，由以高性能、健壮以及可伸缩性出名的 Erlang 写成。&lt;/p&gt;

&lt;h2 id=&quot;安装rabbitmq&quot;&gt;安装RabbitMQ&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;第一步：添加源
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'deb http://www.rabbitmq.com/debian/ testing main'&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;sudo tee&lt;/span&gt; /etc/apt/sources.list.d/rabbitmq.list
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;第二步：添加秘钥
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;wget &lt;span class=&quot;nt&quot;&gt;-O-&lt;/span&gt; https://www.rabbitmq.com/rabbitmq-release-signing-key.asc | &lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-key add
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;第三步：更新源
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get update
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;第四步：安装
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;rabbitmq-server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;开启web管理界面&quot;&gt;开启WEB管理界面&lt;/h2&gt;

&lt;p&gt;RabbitMQ默认没有打开WEB管理界面，需要手动操作&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;rabbitmq-plugins &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;rabbitmq_management
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;通过上面的命令即可开启，打开浏览器访问 http://127.0.0.1:15672 即可看到如下界面&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/post/linux/ubuntu/rabbitmq_login.png&quot; alt=&quot;RabbitMQ登录界面&quot; /&gt;&lt;/p&gt;

&lt;p&gt;使用默认用户guest，密码guest可以登录&lt;/p&gt;

&lt;h2 id=&quot;允许非本地访问管理界面&quot;&gt;允许非本地访问管理界面&lt;/h2&gt;

&lt;p&gt;打开管理界面的功能开关后，虽然guest用户可以访问，但远程访问还需要配置用户才能可以&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;第一步：添加用户
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;rabbitmqctl add_user demo 123456
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;rabbitmqctl list_users
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;添加一个用户名demo，密码为123456的用户记录&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;第二步：设置权限
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;rabbitmqctl set_permissions &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/&quot;&lt;/span&gt; demo &lt;span class=&quot;s2&quot;&gt;&quot;.*&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;.*&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;.*&quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;rabbitmqctl list_permissions &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; /
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;设置demo用户可以从任意ip访问该管理界面&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;第三步：设置角色
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;rabbitmqctl set_user_tags demo administrator
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;rabbitmqctl list_users
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;设置demo用户为管理员权限&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;完成上面操作之后即可使用demo用户登录，登录成功之后可以看到如下界面：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/post/linux/ubuntu/rabbitmq_dashborad.png&quot; alt=&quot;RabbitMQ管理界面&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/linux/2018/02/27/install-java-ee-environment-on-ubuntu.html&quot;&gt;返回目录&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Reference:&lt;/p&gt;
  &lt;ul&gt;
    &lt;li&gt;https://blog.csdn.net/rickey17/article/details/72756766&lt;/li&gt;
    &lt;li&gt;https://blog.haohtml.com/archives/15249&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;</content><author><name>单思义</name><email>keith@thxopen.com</email></author><category term="ubuntu" /><category term="rabbitmq" /><summary type="html">RabbitMQ是一套开源（MPL）的消息队列服务软件，是由 LShift 提供的一个 Advanced Message Queuing Protocol (AMQP) 的开源实现，由以高性能、健壮以及可伸缩性出名的 Erlang 写成。 安装RabbitMQ 第一步：添加源 echo 'deb http://www.rabbitmq.com/debian/ testing main' | sudo tee /etc/apt/sources.list.d/rabbitmq.list 第二步：添加秘钥 wget -O- https://www.rabbitmq.com/rabbitmq-release-signing-key.asc | sudo apt-key add 第三步：更新源 sudo apt-get update 第四步：安装 sudo apt-get install rabbitmq-server 开启WEB管理界面 RabbitMQ默认没有打开WEB管理界面，需要手动操作 sudo rabbitmq-plugins enable rabbitmq_management 通过上面的命令即可开启，打开浏览器访问 http://127.0.0.1:15672 即可看到如下界面 使用默认用户guest，密码guest可以登录 允许非本地访问管理界面 打开管理界面的功能开关后，虽然guest用户可以访问，但远程访问还需要配置用户才能可以 第一步：添加用户 sudo rabbitmqctl add_user demo 123456 sudo rabbitmqctl list_users 添加一个用户名demo，密码为123456的用户记录 第二步：设置权限 sudo rabbitmqctl set_permissions -p &quot;/&quot; demo &quot;.*&quot; &quot;.*&quot; &quot;.*&quot; sudo rabbitmqctl list_permissions -p / 设置demo用户可以从任意ip访问该管理界面 第三步：设置角色 sudo rabbitmqctl set_user_tags demo administrator sudo rabbitmqctl list_users 设置demo用户为管理员权限 完成上面操作之后即可使用demo用户登录，登录成功之后可以看到如下界面： 返回目录 Reference: https://blog.csdn.net/rickey17/article/details/72756766 https://blog.haohtml.com/archives/15249</summary></entry><entry><title type="html">在Ubuntu下安装Nginx</title><link href="http://www.thxopen.com/linux/2018/02/27/install-nginx-on-ubuntu.html" rel="alternate" type="text/html" title="在Ubuntu下安装Nginx" /><published>2018-02-27T00:00:00+08:00</published><updated>2018-02-27T00:00:00+08:00</updated><id>http://www.thxopen.com/linux/2018/02/27/install-nginx-on-ubuntu</id><content type="html" xml:base="http://www.thxopen.com/linux/2018/02/27/install-nginx-on-ubuntu.html">&lt;p&gt;Nginx是一个异步框架的 Web服务器，也可以用作反向代理，负载平衡器 和 HTTP缓存。&lt;/p&gt;

&lt;h2 id=&quot;安装nginx&quot;&gt;安装Nginx&lt;/h2&gt;

&lt;p&gt;在Ubuntu下安装Nginx非常简单，只需要几行命令即可安装完成&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;默认安装后会自己启动，打开浏览器访问127.0.0.1即可看到nginx默认的欢迎界面&lt;/p&gt;

&lt;p&gt;ps：确认80端口没有被其他应用程序占用&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Reference&lt;/p&gt;
  &lt;ul&gt;
    &lt;li&gt;https://www.jianshu.com/p/7cb1a824333e&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;permission-denied&quot;&gt;Permission denied&lt;/h2&gt;

&lt;p&gt;由于我使用Nginx对本地路径做映射，默认情况下nginx会创建自己的用户名和用户组，这样我用非Nginx的用户创建的文件可能会不能访问，
出现Permission denied的错误提示，这里我修改了配置文件让nginx使用同样的用户&lt;/p&gt;

&lt;p&gt;配置文件一般会在&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/etc/nginx/nginx.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;这个文件第一行即是&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;user nginx&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# 修改成自己的用户，这里我用户名是ubuntu&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#下面是修改后的&lt;/span&gt;
user ubuntu&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;修改完后保存退出，然后重启nginx即可&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;service nginx restart
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;如何安装最新版nginx&quot;&gt;如何安装最新版Nginx&lt;/h2&gt;

&lt;h4 id=&quot;2018年7月7日-更新&quot;&gt;2018年7月7日 更新&lt;/h4&gt;

&lt;p&gt;默认情况下，通过命令安装的Nginx不是官方的最新版本，而是一个相对稳定的版本（1.10.0）。&lt;/p&gt;

&lt;p&gt;在项目中我需要用到gRPC，希望也能通过Nginx来进行负载均衡，发现Nginx从1.13.10版本才开始支持gRPC，迫使我要升级Nginx&lt;/p&gt;

&lt;p&gt;哪怎么通过命令安装官方最新的Nginx呢？下面来告诉大家，希望能帮助到需要的小伙伴&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;第一步：找到最新的&lt;a href=&quot;https://nginx.org/en/linux_packages.html&quot;&gt;发行版&lt;/a&gt; ,添加源到本地apt-get sources列表中，
如果你的系统是ubuntu 16.04，则可以使用下面的源
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'deb http://nginx.org/packages/mainline/ubuntu/ xenial nginx'&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;sudo tee&lt;/span&gt; /etc/apt/sources.list.d/nginx.list
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ps: 如果是Ubuntu 14.04就把&lt;code class=&quot;highlighter-rouge&quot;&gt;xenial&lt;/code&gt;换成&lt;code class=&quot;highlighter-rouge&quot;&gt;trusty&lt;/code&gt;，附一张对照表&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;系统版本&lt;/th&gt;
      &lt;th&gt;Codename&lt;/th&gt;
      &lt;th&gt;支持平台&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;12.04&lt;/td&gt;
      &lt;td&gt;precise&lt;/td&gt;
      &lt;td&gt;x86_64, i386&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;14.04&lt;/td&gt;
      &lt;td&gt;trusty&lt;/td&gt;
      &lt;td&gt;x86_64, i386, aarch64/arm64&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;15.10&lt;/td&gt;
      &lt;td&gt;wily&lt;/td&gt;
      &lt;td&gt;x86_64, i386&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;16.04&lt;/td&gt;
      &lt;td&gt;xenial&lt;/td&gt;
      &lt;td&gt;x86_64, i386&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;ul&gt;
  &lt;li&gt;第二步：添加秘钥
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;wget &lt;span class=&quot;nt&quot;&gt;-O-&lt;/span&gt; http://nginx.org/keys/nginx_signing.key | &lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-key add
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;第三步：更新源
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get update
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;第四步：安装最新Nginx
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;第五步：查看版本
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nginx &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt;
nginx version: nginx/1.15.0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;可以看到，已经是最新的1.15.0&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/linux/2018/02/27/install-java-ee-environment-on-ubuntu.html&quot;&gt;返回目录&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Reference&lt;/p&gt;
  &lt;ul&gt;
    &lt;li&gt;https://juejin.im/entry/5a274c7751882533d022eec2&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;</content><author><name>单思义</name><email>keith@thxopen.com</email></author><category term="ubuntu" /><category term="nginx" /><summary type="html">Nginx是一个异步框架的 Web服务器，也可以用作反向代理，负载平衡器 和 HTTP缓存。 安装Nginx 在Ubuntu下安装Nginx非常简单，只需要几行命令即可安装完成 sudo apt-get install nginx 默认安装后会自己启动，打开浏览器访问127.0.0.1即可看到nginx默认的欢迎界面 ps：确认80端口没有被其他应用程序占用 Reference https://www.jianshu.com/p/7cb1a824333e Permission denied 由于我使用Nginx对本地路径做映射，默认情况下nginx会创建自己的用户名和用户组，这样我用非Nginx的用户创建的文件可能会不能访问， 出现Permission denied的错误提示，这里我修改了配置文件让nginx使用同样的用户 配置文件一般会在 /etc/nginx/nginx.conf 这个文件第一行即是 user nginx; # 修改成自己的用户，这里我用户名是ubuntu #下面是修改后的 user ubuntu; 修改完后保存退出，然后重启nginx即可 sudo service nginx restart 如何安装最新版Nginx 2018年7月7日 更新 默认情况下，通过命令安装的Nginx不是官方的最新版本，而是一个相对稳定的版本（1.10.0）。 在项目中我需要用到gRPC，希望也能通过Nginx来进行负载均衡，发现Nginx从1.13.10版本才开始支持gRPC，迫使我要升级Nginx 哪怎么通过命令安装官方最新的Nginx呢？下面来告诉大家，希望能帮助到需要的小伙伴 第一步：找到最新的发行版 ,添加源到本地apt-get sources列表中， 如果你的系统是ubuntu 16.04，则可以使用下面的源 echo 'deb http://nginx.org/packages/mainline/ubuntu/ xenial nginx' | sudo tee /etc/apt/sources.list.d/nginx.list ps: 如果是Ubuntu 14.04就把xenial换成trusty，附一张对照表 系统版本 Codename 支持平台 12.04 precise x86_64, i386 14.04 trusty x86_64, i386, aarch64/arm64 15.10 wily x86_64, i386 16.04 xenial x86_64, i386 第二步：添加秘钥 wget -O- http://nginx.org/keys/nginx_signing.key | sudo apt-key add 第三步：更新源 sudo apt-get update 第四步：安装最新Nginx sudo apt-get install nginx 第五步：查看版本 nginx -v nginx version: nginx/1.15.0 可以看到，已经是最新的1.15.0 返回目录 Reference https://juejin.im/entry/5a274c7751882533d022eec2</summary></entry><entry><title type="html">在Ubuntu下安装MySQL</title><link href="http://www.thxopen.com/linux/2018/02/27/install-mysql-on-ubuntu.html" rel="alternate" type="text/html" title="在Ubuntu下安装MySQL" /><published>2018-02-27T00:00:00+08:00</published><updated>2018-02-27T00:00:00+08:00</updated><id>http://www.thxopen.com/linux/2018/02/27/install-mysql-on-ubuntu</id><content type="html" xml:base="http://www.thxopen.com/linux/2018/02/27/install-mysql-on-ubuntu.html">&lt;p&gt;MySQL是一个开放源代码的关系数据库管理系统，性能高、成本低、可靠性好，已经成为最流行的开源数据库。&lt;/p&gt;

&lt;h2 id=&quot;安装mysql&quot;&gt;安装MySQL&lt;/h2&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;mysql-server mysql-client
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;安装过程中会要求输入root用户的密码，记下自己输入的密码即可&lt;/p&gt;

&lt;h2 id=&quot;更改默认端口&quot;&gt;更改默认端口&lt;/h2&gt;

&lt;p&gt;mysql默认的端口是3306，一般情况下我们会更改默认端口，当你数据库暴露在外网时可以一定程度上防止攻击&lt;/p&gt;

&lt;p&gt;编辑目录 &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/mysql/mysql.conf.d/mysqld.cnf&lt;/code&gt; 下mysql的配置文件：&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;vim /etc/mysql/mysql.conf.d/mysqld.cnf

&lt;span class=&quot;c&quot;&gt;# * Basic Settings&lt;/span&gt;
user            &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; mysql
pid-file        &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /var/run/mysqld/mysqld.pid
socket          &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /var/run/mysqld/mysqld.sock
port            &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 7777   &lt;span class=&quot;c&quot;&gt;#修改自己需要的端口&lt;/span&gt;
basedir         &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /usr
datadir         &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /var/lib/mysql
tmpdir          &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /tmp
lc-messages-dir &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /usr/share/mysql
skip-external-locking

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;这里演示把默认端口修改为7777，保存修改，重启mysql即可&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;service mysql restart
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;重启之后，查询端口来验证是否修改成功&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;netstat &lt;span class=&quot;nt&quot;&gt;-nlt&lt;/span&gt;|grep 7777

tcp        0      0 0.0.0.0:7777            0.0.0.0:&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;               LISTEN
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;授权可以访问的客户端&quot;&gt;授权可以访问的客户端&lt;/h2&gt;

&lt;p&gt;默认情况下，mysql只允许本地操作，如果我们的mysql安装在服务器上，避免不了远程连接，为了方便，这里我允许所有ip远程操作mysql&lt;/p&gt;

&lt;p&gt;首先登录到mysql，授权root用户可以从任意ip获得所有特权&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql &lt;span class=&quot;nt&quot;&gt;-uroot&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt;
Enter password:

mysql&amp;gt; grant all privileges on &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;.&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; to &lt;span class=&quot;s1&quot;&gt;'root'&lt;/span&gt;@&lt;span class=&quot;s1&quot;&gt;'%'&lt;/span&gt; identified by &lt;span class=&quot;s1&quot;&gt;'你的密码'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
mysql&amp;gt; flush privileges&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
mysql&amp;gt; &lt;span class=&quot;nb&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ps：为了安全，你可以指定ip和操作权限&lt;/p&gt;

&lt;p&gt;然后，更改mysql配置文件允许从任意ip连接&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;vim /etc/mysql/mysql.conf.d/mysqld.cnf

&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Instead of skip-networking the default is now to listen only on&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# localhost which is more compatible and is not less secure.&lt;/span&gt;
bind-address            &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0.0.0.0  &lt;span class=&quot;c&quot;&gt;#把127.0.0.1修改为0.0.0.0即可&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;service mysql restart

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;把&lt;code class=&quot;highlighter-rouge&quot;&gt;127.0.0.1&lt;/code&gt;修改为&lt;code class=&quot;highlighter-rouge&quot;&gt;0.0.0.0&lt;/code&gt;即可，然后保存修改，重启mysql生效&lt;/p&gt;

&lt;h2 id=&quot;在console中使用mysql&quot;&gt;在console中使用mysql&lt;/h2&gt;

&lt;p&gt;检测是否可以正常使用mysql，打开命令行，使用root用户和刚刚输入的密码连接到mysql&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;thxopen@Thxopen:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;mysql &lt;span class=&quot;nt&quot;&gt;-uroot&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt;
Enter password:

Welcome to the MySQL monitor.  Commands end with &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; or &lt;span class=&quot;se&quot;&gt;\g&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Your MySQL connection &lt;span class=&quot;nb&quot;&gt;id &lt;/span&gt;is 6
Server version: 5.7.22-0ubuntu0.16.04.1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

Copyright &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 2000, 2018, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type &lt;span class=&quot;s1&quot;&gt;'help;'&lt;/span&gt; or &lt;span class=&quot;s1&quot;&gt;'\h'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;help. Type &lt;span class=&quot;s1&quot;&gt;'\c'&lt;/span&gt; to clear the current input statement.

mysql&amp;gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;出现上述代表mysql安装成功，可以正常使用&lt;/p&gt;

&lt;h2 id=&quot;使用mysql-workbench操作mysql数据&quot;&gt;使用MySQL Workbench操作mysql数据&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://www.mysql.com/products/workbench/&quot;&gt;MySQL Workbench&lt;/a&gt; 是一个可视化的，可以对mysql配置、用户管理、备份、数据建模、SQL开发等进行操作的综合管理工具。
支持在Windows, Linux 和 Mac OS X上使用。&lt;/p&gt;

&lt;p&gt;在官网上&lt;a href=&quot;https://dev.mysql.com/downloads/workbench/&quot;&gt;下载&lt;/a&gt;对应平台的安装包，安装即可使用。&lt;/p&gt;

&lt;p&gt;工具欢迎面如下图所示：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/post/linux/ubuntu/mysql workbench dashboard.png&quot; alt=&quot;mysql workbench dashboard&quot; /&gt;&lt;/p&gt;

&lt;p&gt;界面看起来比较清爽，简洁，但是功能非常强大。&lt;/p&gt;

&lt;p&gt;可以通过【加号】按钮新建一个mysql连接，如下图所示：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/post/linux/ubuntu/mysql new connection.png&quot; alt=&quot;mysql new connection&quot; /&gt;&lt;/p&gt;

&lt;p&gt;输入mysql服务器地址、端口、密码，点击【Test Connection】检查是否连接成功。&lt;/p&gt;

&lt;p&gt;进入MySQL Workbench主界面，如下图所示：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/post/linux/ubuntu/mysql sql console.png&quot; alt=&quot;mysql sql console&quot; /&gt;&lt;/p&gt;

&lt;p&gt;主要关注的是中间部分，分别有sql脚本输入区域，表格数据显示区域，历史脚本显示区域&lt;/p&gt;

&lt;p&gt;整体来说MySQL Workbench还是一个不错的可视化的工具，官方出品，推荐一下。&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/linux/2018/02/27/install-java-ee-environment-on-ubuntu.html&quot;&gt;返回目录&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Reference&lt;/p&gt;
  &lt;ul&gt;
    &lt;li&gt;http://www.jianshu.com/p/3111290b87f4&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;</content><author><name>单思义</name><email>keith@thxopen.com</email></author><category term="ubuntu" /><category term="nginx" /><summary type="html">MySQL是一个开放源代码的关系数据库管理系统，性能高、成本低、可靠性好，已经成为最流行的开源数据库。 安装MySQL sudo apt-get install mysql-server mysql-client 安装过程中会要求输入root用户的密码，记下自己输入的密码即可 更改默认端口 mysql默认的端口是3306，一般情况下我们会更改默认端口，当你数据库暴露在外网时可以一定程度上防止攻击 编辑目录 /etc/mysql/mysql.conf.d/mysqld.cnf 下mysql的配置文件： sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf # * Basic Settings user = mysql pid-file = /var/run/mysqld/mysqld.pid socket = /var/run/mysqld/mysqld.sock port = 7777 #修改自己需要的端口 basedir = /usr datadir = /var/lib/mysql tmpdir = /tmp lc-messages-dir = /usr/share/mysql skip-external-locking 这里演示把默认端口修改为7777，保存修改，重启mysql即可 sudo service mysql restart 重启之后，查询端口来验证是否修改成功 netstat -nlt|grep 7777 tcp 0 0 0.0.0.0:7777 0.0.0.0:* LISTEN 授权可以访问的客户端 默认情况下，mysql只允许本地操作，如果我们的mysql安装在服务器上，避免不了远程连接，为了方便，这里我允许所有ip远程操作mysql 首先登录到mysql，授权root用户可以从任意ip获得所有特权 mysql -uroot -p Enter password: mysql&amp;gt; grant all privileges on *.* to 'root'@'%' identified by '你的密码'; mysql&amp;gt; flush privileges; mysql&amp;gt; exit; ps：为了安全，你可以指定ip和操作权限 然后，更改mysql配置文件允许从任意ip连接 sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf # # Instead of skip-networking the default is now to listen only on # localhost which is more compatible and is not less secure. bind-address = 0.0.0.0 #把127.0.0.1修改为0.0.0.0即可 sudo service mysql restart 把127.0.0.1修改为0.0.0.0即可，然后保存修改，重启mysql生效 在console中使用mysql 检测是否可以正常使用mysql，打开命令行，使用root用户和刚刚输入的密码连接到mysql thxopen@Thxopen:~$ mysql -uroot -p Enter password: Welcome to the MySQL monitor. Commands end with ; or \g. Your MySQL connection id is 6 Server version: 5.7.22-0ubuntu0.16.04.1 (Ubuntu) Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\h' for help. Type '\c' to clear the current input statement. mysql&amp;gt; 出现上述代表mysql安装成功，可以正常使用 使用MySQL Workbench操作mysql数据 MySQL Workbench 是一个可视化的，可以对mysql配置、用户管理、备份、数据建模、SQL开发等进行操作的综合管理工具。 支持在Windows, Linux 和 Mac OS X上使用。 在官网上下载对应平台的安装包，安装即可使用。 工具欢迎面如下图所示： 界面看起来比较清爽，简洁，但是功能非常强大。 可以通过【加号】按钮新建一个mysql连接，如下图所示： 输入mysql服务器地址、端口、密码，点击【Test Connection】检查是否连接成功。 进入MySQL Workbench主界面，如下图所示： 主要关注的是中间部分，分别有sql脚本输入区域，表格数据显示区域，历史脚本显示区域 整体来说MySQL Workbench还是一个不错的可视化的工具，官方出品，推荐一下。 返回目录 Reference http://www.jianshu.com/p/3111290b87f4</summary></entry><entry><title type="html">在Ubuntu下安装JAVA开发环境</title><link href="http://www.thxopen.com/linux/2018/02/27/install-java-on-ubuntu.html" rel="alternate" type="text/html" title="在Ubuntu下安装JAVA开发环境" /><published>2018-02-27T00:00:00+08:00</published><updated>2018-02-27T00:00:00+08:00</updated><id>http://www.thxopen.com/linux/2018/02/27/install-java-on-ubuntu</id><content type="html" xml:base="http://www.thxopen.com/linux/2018/02/27/install-java-on-ubuntu.html">&lt;p&gt;JDK即Java Development Kit，java开发工具包，是java开发人员开发中需要用到的软件开发工具包。&lt;/p&gt;

&lt;h2 id=&quot;安装jdk&quot;&gt;安装JDK&lt;/h2&gt;

&lt;p&gt;在Ubuntu下安装java开发环境有两种途径：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;通过apt-get在线安装&lt;/li&gt;
  &lt;li&gt;下载tar包，自行解压安装&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;本文介绍的是第一种方式，使用apt-get安装java开发环境&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;第一步：添加源
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;add-apt-repository ppa:webupd8team/java
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;第二步：更新源
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get update
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;第三步：安装jdk，这里选择的是jdk 8
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;oracle-java8-installer
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;&lt;img src=&quot;/assets/images/post/linux/ubuntu/oracle1.png&quot; alt=&quot;oracle java 条款&quot; /&gt;
&lt;img src=&quot;/assets/images/post/linux/ubuntu/oracle2.png&quot; alt=&quot;oracle java 条款&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;安装过程中，会提示同意条款，输入y即可&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;第四步：检查是否安装成功
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;java &lt;span class=&quot;nt&quot;&gt;-version&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;控制台输出如下，表示安装成功&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;java version &lt;span class=&quot;s2&quot;&gt;&quot;1.8.0_161&quot;&lt;/span&gt;
Java&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;TM&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; SE Runtime Environment &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;build 1.8.0_161-b12&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Java HotSpot&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;TM&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 64-Bit Server VM &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;build 25.161-b12, mixed mode&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;/linux/2018/02/27/install-java-ee-environment-on-ubuntu.html&quot;&gt;返回目录&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Reference&lt;/p&gt;
  &lt;ul&gt;
    &lt;li&gt;http://www.cnblogs.com/a2211009/p/4265225.html&lt;/li&gt;
    &lt;li&gt;http://blog.csdn.net/yuzaipiaofei/article/details/7281723&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;</content><author><name>单思义</name><email>keith@thxopen.com</email></author><category term="ubuntu" /><category term="jdk" /><category term="java" /><summary type="html">JDK即Java Development Kit，java开发工具包，是java开发人员开发中需要用到的软件开发工具包。 安装JDK 在Ubuntu下安装java开发环境有两种途径： 通过apt-get在线安装 下载tar包，自行解压安装 本文介绍的是第一种方式，使用apt-get安装java开发环境 第一步：添加源 sudo add-apt-repository ppa:webupd8team/java 第二步：更新源 sudo apt-get update 第三步：安装jdk，这里选择的是jdk 8 sudo apt-get install oracle-java8-installer 安装过程中，会提示同意条款，输入y即可 第四步：检查是否安装成功 java -version 控制台输出如下，表示安装成功 java version &quot;1.8.0_161&quot; Java(TM) SE Runtime Environment (build 1.8.0_161-b12) Java HotSpot(TM) 64-Bit Server VM (build 25.161-b12, mixed mode) 返回目录 Reference http://www.cnblogs.com/a2211009/p/4265225.html http://blog.csdn.net/yuzaipiaofei/article/details/7281723</summary></entry><entry><title type="html">在Ubuntu上安装常用的和Java相关的工具</title><link href="http://www.thxopen.com/linux/2018/02/27/install-java-ee-environment-on-ubuntu.html" rel="alternate" type="text/html" title="在Ubuntu上安装常用的和Java相关的工具" /><published>2018-02-27T00:00:00+08:00</published><updated>2018-02-27T00:00:00+08:00</updated><id>http://www.thxopen.com/linux/2018/02/27/install-java-ee-environment-on-ubuntu</id><content type="html" xml:base="http://www.thxopen.com/linux/2018/02/27/install-java-ee-environment-on-ubuntu.html">&lt;p&gt;最近工作中经常需要在新服务器上搭建环境，项目中用到的工具有Tomcat、RabbitMQ、Nginx、Redis、MySQL。&lt;/p&gt;

&lt;p&gt;还别说，这几个工具把他安装好配置好，需要花的时间还是挺长的。在多次安装和配置过程中我也遇到一些问题，也总结了些经验。&lt;/p&gt;

&lt;p&gt;在此纪录下来，方便自己也方便他人。&lt;/p&gt;

&lt;p&gt;本篇为目录，列出标题，我在单独的文章里再详细介绍每个工具的安装和使用。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;/linux/2018/02/27/install-java-on-ubuntu.html&quot;&gt;在Ubuntu下安装JAVA开发环境&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/linux/2018/02/27/install-rabbitmq-on-ubuntu.html&quot;&gt;在Ubuntu下安装RabbitMQ&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/linux/2018/02/27/install-nginx-on-ubuntu.html&quot;&gt;在Ubuntu下安装Nginx&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/linux/2018/02/27/install-mysql-on-ubuntu.html&quot;&gt;在Ubuntu下安装MySQL&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/linux/2018/02/27/install-redis-on-ubuntu.html&quot;&gt;在Ubuntu下安装Redis&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;上面的方法同样适用 Win10 带的子系统 Bash on Windows ，都是Ubuntu，本人电脑就是直接在子系统里安装这些软件用来开发，
比起安装虚拟机要方便很多，希望这一系列文章对大家有所帮助&lt;/p&gt;</content><author><name>单思义</name><email>keith@thxopen.com</email></author><category term="ubuntu" /><category term="tomcat" /><category term="rabbitmq" /><category term="nginx" /><category term="redis" /><category term="jdk" /><category term="mysql" /><summary type="html">最近工作中经常需要在新服务器上搭建环境，项目中用到的工具有Tomcat、RabbitMQ、Nginx、Redis、MySQL。 还别说，这几个工具把他安装好配置好，需要花的时间还是挺长的。在多次安装和配置过程中我也遇到一些问题，也总结了些经验。 在此纪录下来，方便自己也方便他人。 本篇为目录，列出标题，我在单独的文章里再详细介绍每个工具的安装和使用。 在Ubuntu下安装JAVA开发环境 在Ubuntu下安装RabbitMQ 在Ubuntu下安装Nginx 在Ubuntu下安装MySQL 在Ubuntu下安装Redis 上面的方法同样适用 Win10 带的子系统 Bash on Windows ，都是Ubuntu，本人电脑就是直接在子系统里安装这些软件用来开发， 比起安装虚拟机要方便很多，希望这一系列文章对大家有所帮助</summary></entry></feed>